<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ Thống Quản Trị VTC Pay</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --vtc-blue: #0068ac;
            --vtc-blue-dark: #005691;
            --header-bg: #f8f9fa;
            --table-header-bg: #e9ecef;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #fff;
            font-size: 13px;
        }

        /* Highlight Styles for New Fields */
        .highlight-new-field {
            border: 2px dashed #dc3545 !important; /* Red dashed border */
            background-color: #fff5f5 !important;
        }
        
        .highlight-new-label {
            color: #dc3545 !important;
            font-weight: bold;
            text-decoration: underline;
            text-decoration-style: dashed;
        }

        .highlight-new-col-header {
            background-color: #ffe6e6 !important;
            color: #dc3545 !important;
            border-bottom: 2px dashed #dc3545 !important;
            border-left: 2px dashed #dc3545 !important;
            border-right: 2px dashed #dc3545 !important;
        }

        .highlight-new-col-cell {
            background-color: #fff5f5 !important;
            border-left: 2px dashed #ffcccc !important;
            border-right: 2px dashed #ffcccc !important;
            color: #dc3545;
            font-weight: 600;
        }

        /* Top Navbar Responsive */
        .top-nav {
            background-color: #fff;
            border-bottom: 1px solid #ddd;
            padding: 10px 15px;
        }

        .logo-text {
            font-weight: 800;
            font-size: 24px;
            color: var(--vtc-blue);
            font-style: italic;
            text-decoration: none;
            white-space: nowrap;
        }
        
        .nav-btn {
            background-color: #fff;
            color: var(--vtc-blue);
            border: 1px solid var(--vtc-blue);
            border-radius: 3px;
            padding: 6px 12px;
            margin: 2px;
            font-size: 13px;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            cursor: pointer;
        }
        
        .nav-btn:hover {
            background-color: #e6f7ff;
        }

        .nav-btn.active-tab {
            background-color: var(--vtc-blue);
            color: white;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .user-info {
            color: var(--vtc-blue);
            font-weight: 500;
            white-space: nowrap;
        }

        /* Page Title Bar */
        .page-title-bar {
            background-color: #337ab7;
            color: white;
            padding: 10px 15px;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 20px;
            border-left: 5px solid #1b5480;
            font-size: 14px;
        }

        /* Filter Section Optimized */
        .filter-section {
            padding: 0 15px;
            margin-bottom: 20px;
            background-color: #fff;
        }
        
        /* Mobile Filter Toggle */
        .filter-toggle-container {
            display: none;
            margin-bottom: 10px;
        }
        .btn-filter-toggle {
            width: 100%;
            text-align: left;
            background-color: #f0f7ff;
            color: #0068ac;
            border: 1px solid #cce5ff;
            font-weight: 600;
            padding: 8px 15px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .filter-label {
            font-weight: 600;
            color: #0068ac;
            display: flex;
            align-items: center;
            font-size: 13px;
            padding-top: 6px;
            white-space: nowrap;
        }
        
        .filter-label i {
            margin-right: 6px;
            width: 16px;
            text-align: center;
        }

        .form-control, .form-select {
            font-size: 13px;
            border-radius: 3px;
            padding: 5px 8px;
        }

        .btn-search {
            background-color: #26b6d4;
            color: white;
            border: none;
            padding: 8px 30px;
            border-radius: 3px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: background 0.2s;
        }
        
        .btn-search:hover {
            background-color: #1a9cb7;
            color: white;
        }

        /* Action Toolbar */
        .action-toolbar {
            padding: 10px 15px;
            margin-bottom: 10px;
            background-color: #f8f9fa;
            border-top: 1px solid #eee;
            border-bottom: 1px solid #eee;
        }

        .toolbar-btn {
            font-size: 12px;
            margin-right: 5px;
            background-color: #fff;
            border: 1px solid #ccc;
            color: #333;
            margin-bottom: 5px;
        }
        
        .toolbar-btn:hover {
            background-color: #e2e6ea;
        }

        /* Table Responsive Wrapper */
        .table-responsive-custom {
            padding: 0 15px;
            margin-bottom: 20px;
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            position: relative;
        }

        .table {
            font-size: 12px;
            white-space: nowrap;
            margin-bottom: 0;
            border-collapse: separate;
            border-spacing: 0;
        }

        .table thead th {
            background-color: #dff0d8;
            vertical-align: middle;
            text-align: center;
            border-bottom: 2px solid #aeccae;
            border-top: 1px solid #dee2e6;
            color: #333;
            font-weight: bold;
            padding: 10px 8px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        /* Sticky Action Column */
        .sticky-col-right {
            position: sticky;
            right: 0;
            z-index: 5;
            border-left: 2px solid #dee2e6;
            box-shadow: -4px 0 8px rgba(0,0,0,0.08);
            clip-path: inset(0px -15px 0px 0px);
        }
        
        thead th.sticky-col-right {
            background-color: #dff0d8 !important;
            z-index: 15;
        }
        
        tbody td.sticky-col-right {
            background-color: #fff;
        }
        
        .table-striped tbody tr:nth-of-type(odd) td.sticky-col-right {
            background-color: #f9f9f9;
        }
        .table-striped tbody tr:hover td.sticky-col-right {
            background-color: #e8f4fd;
        }

        /* Resizer */
        .resizer {
            position: absolute;
            top: 0;
            right: 0;
            width: 5px;
            cursor: col-resize;
            user-select: none;
            height: 100%;
            z-index: 20;
            background-color: transparent; 
        }

        .resizer:hover, .resizing {
            background-color: #00a0e3; 
            width: 4px;
        }
        
        .table-striped tbody tr:nth-of-type(odd) {
            background-color: #f9f9f9;
        }

        .table td {
            vertical-align: middle;
            padding: 8px;
            border-bottom: 1px solid #dee2e6;
        }

        /* Status Colors */
        .status-success { color: #28a745; font-weight: 500; }
        .status-cancel { color: #dc3545; }
        .status-init { color: #6c757d; font-style: italic;}
        .status-refund { color: #fd7e14; }

        /* Action Buttons */
        .action-btn-group button {
            margin: 0 2px;
            padding: 3px 8px;
            font-size: 11px;
            border-radius: 3px;
            border: none;
            color: white;
            transition: opacity 0.2s;
        }
        
        .action-btn-group button:hover { opacity: 0.85; }
        .btn-view { background-color: #f0ad4e; }
        .btn-check { background-color: #0d6efd; }
        .btn-cancel { background-color: #dc3545; }

        /* Footer Pagination */
        .footer-pagination {
            padding: 15px;
            background-color: #f8f9fa;
            border-top: 1px solid #ddd;
            font-size: 12px;
        }

        .pagination { margin-bottom: 0; }
        .page-link { color: #337ab7; }
        .page-item.active .page-link { background-color: #337ab7; border-color: #337ab7; }

        /* Helper for hiding/showing sections */
        .d-none-custom {
            display: none !important;
        }

        /* Responsive Breakpoints */
        @media (max-width: 992px) {
            .filter-label { margin-bottom: 4px; }
            .col-form-container { margin-bottom: 10px; }
            .logo-text { font-size: 20px; }
        }

        @media (max-width: 768px) {
            .top-nav { flex-direction: column; align-items: flex-start !important; gap: 10px; }
            
            .nav-menu-container { 
                width: 100%; 
                display: flex; 
                flex-wrap: nowrap !important;
                gap: 8px; 
                margin-left: 0 !important; 
                margin-top: 5px;
                overflow-x: auto;
                padding-bottom: 5px;
                -webkit-overflow-scrolling: touch;
            }
            
            .nav-btn {
                flex: 0 0 auto;
                white-space: nowrap;
            }

            .user-info-container { width: 100%; justify-content: space-between; margin-top: 5px; border-top: 1px solid #eee; padding-top: 5px;}
            
            .action-toolbar { flex-direction: column; align-items: flex-start; gap: 10px; }
            .toolbar-right { width: 100%; }
            .toolbar-right input { flex-grow: 1; }
            
            .footer-pagination { flex-direction: column; gap: 10px; align-items: center; }

            .filter-toggle-container { display: block; }
            .filter-content-wrapper { display: none; }
            .filter-content-wrapper.show { display: block; animation: slideDown 0.3s ease-out; }
            
            .table thead th { top: -1px; }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

    <!-- Header Section -->
    <div class="d-flex justify-content-between align-items-center top-nav">
        <div class="d-flex align-items-center flex-wrap w-100 overflow-hidden">
            <a href="#" class="logo-text me-3 flex-shrink-0">
                <i class="fa-solid fa-wifi fa-rotate-90 me-1" style="font-size: 18px;"></i>VTC<span style="color: #00a0e3">Pay</span>
            </a>
            
            <!-- Navigation Menu -->
            <div class="ms-md-3 nav-menu-container">
                <button id="nav-approval" class="nav-btn active-tab" onclick="switchTab('approval')">
                    <i class="fa-solid fa-money-bill me-2"></i> 
                    Duyệt tiền cổng
                </button>
                <button id="nav-report" class="nav-btn" onclick="switchTab('report')">
                    <i class="fa-solid fa-chart-bar me-2"></i> 
                    Báo cáo Merchant
                </button>
            </div>
        </div>
        
        <!-- User Info -->
        <div class="d-flex align-items-center user-info-container ms-3">
            <span class="user-info me-2"><i class="fa-solid fa-circle-user me-1"></i> hongtt</span>
            <a href="#" class="text-danger" title="Đăng xuất"><i class="fa-solid fa-right-from-bracket"></i></a>
        </div>
    </div>

    <!-- ==============================================
         MODULE 1: DUYỆT TIỀN CỔNG THANH TOÁN (DEFAULT)
         ============================================== -->
    <div id="section-approval">
        <div class="page-title-bar shadow-sm">
            <i class="fa-solid fa-dollar-sign me-2"></i> DUYỆT TIỀN CÔNG THANH TOÁN
        </div>

        <div class="container-fluid filter-section">
            <div class="filter-toggle-container d-md-none">
                <button class="btn btn-filter-toggle" onclick="toggleFilter('filter-approval')">
                    <span><i class="fa-solid fa-filter me-2"></i> Bộ lọc tìm kiếm</span>
                    <i class="fa-solid fa-chevron-down icon-toggle"></i>
                </button>
            </div>

            <div id="filter-approval" class="filter-content-wrapper">
                <div class="row align-items-center mb-2">
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-regular fa-calendar-days"></i> Từ Ngày</label></div>
                    <div class="col-lg-3 col-md-6 mb-2">
                        <div class="input-group"><input type="text" class="form-control" value="14/01/2026 10:55"><span class="input-group-text bg-white"><i class="fa-solid fa-calendar text-primary"></i></span></div>
                    </div>
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-regular fa-calendar-days"></i> Đến Ngày</label></div>
                    <div class="col-lg-3 col-md-6 mb-2">
                        <div class="input-group"><input type="text" class="form-control" value="21/01/2026 23:59"><span class="input-group-text bg-white"><i class="fa-solid fa-calendar text-primary"></i></span></div>
                    </div>
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-barcode"></i> Mã đơn</label></div>
                    <div class="col-lg-3 col-md-12 mb-2"><input type="text" class="form-control" placeholder="Nhập mã đơn hàng..."></div>
                </div>
                
                <div class="row align-items-center mb-2">
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-regular fa-id-card"></i> Mã đối tác</label></div>
                    <div class="col-lg-3 col-md-6 mb-2"><input type="text" class="form-control"></div>
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-wallet"></i> TK VTCPay</label></div>
                    <div class="col-lg-3 col-md-6 mb-2"><input type="text" class="form-control"></div>
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-building-columns"></i> TK Ngân hàng</label></div>
                    <div class="col-lg-3 col-md-12 mb-2"><input type="text" class="form-control"></div>
                </div>

                <div class="row align-items-center mb-2">
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-money-check"></i> Loại GD</label></div>
                    <div class="col-lg-3 col-md-6 mb-2"><select class="form-select"><option>Tất Cả</option><option>Thanh toán qua Deeplink App</option><option>Thanh toán chuyển khoản</option></select></div>
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-building"></i> Ngân Hàng</label></div>
                    <div class="col-lg-3 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option><option>NCB</option><option>ZaloPay</option></select></div>
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-filter"></i> Trạng thái</label></div>
                    <div class="col-lg-3 col-md-12 mb-2"><select class="form-select"><option>Tất Cả</option><option>Thành công</option><option>Hủy</option><option>Khởi tạo</option></select></div>
                </div>

                <div class="row align-items-center mb-2">
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-network-wired"></i> Kênh</label></div>
                    <div class="col-lg-3 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option></select></div>
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-hashtag"></i> VtcTransID</label></div>
                    <div class="col-lg-3 col-md-6 mb-2"><input type="text" class="form-control"></div>
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label highlight-new-label"><i class="fa-solid fa-store"></i> Sub-Mer</label></div>
                    <div class="col-lg-3 col-md-12 mb-2"><input type="text" class="form-control highlight-new-field" placeholder="Nhập TK Sub-Merchant"></div>
                </div>
                
                <div class="text-center mt-3 mb-3 pb-2 border-bottom">
                     <button class="btn-search ripple"><i class="fa-solid fa-magnifying-glass me-1"></i> Tra Cứu</button>
                </div>
            </div>
        </div>

        <div class="d-flex justify-content-between align-items-center action-toolbar rounded mx-3">
            <div class="toolbar-left d-flex flex-wrap">
                <button class="btn toolbar-btn"><i class="fa-solid fa-cloud-arrow-down text-primary"></i> Xuất dữ liệu</button>
                <button class="btn toolbar-btn"><i class="fa-solid fa-bars text-primary"></i> Hiện 10 dòng</button>
                <button class="btn toolbar-btn"><i class="fa-solid fa-eye-slash text-primary"></i> Ẩn/hiện cột</button>
            </div>
            <div class="toolbar-right d-flex align-items-center">
                <span class="me-2 fw-bold text-secondary" style="font-size: 12px; white-space: nowrap;">Tìm nhanh:</span>
                <input type="text" class="form-control form-control-sm" placeholder="Nhập từ khóa...">
            </div>
        </div>

        <div class="table-responsive-custom">
            <table id="table-approval" class="table table-bordered table-striped table-hover align-middle">
                <thead>
                    <tr>
                        <th>Thời gian</th>
                        <th>Mã đối tác</th>
                        <th>Mã Đơn Hàng</th>
                        <th>VtcTransID</th>
                        <th>Mã GD</th>
                        <th>Loại giao dịch</th>
                        <th>Ngân Hàng</th>
                        <th>TK Merchant</th>
                        <th class="highlight-new-col-header">TK Sub-Merchant</th>
                        <th>Tên đầy đủ</th>
                        <th>TK Ngân Hàng</th>
                        <th>Số Tiền</th>
                        <th>Mã GD Ngân hàng</th>
                        <th>Người thực hiện</th>
                        <th>TG thành công</th>
                        <th>Loại merchant</th>
                        <th>Cổng kết nối</th>
                        <th>Trạng thái</th>
                        <th class="text-center sticky-col-right">Chức Năng</th>
                    </tr>
                </thead>
                <tbody id="tbody-approval"></tbody>
            </table>
        </div>

        <div class="d-flex justify-content-between align-items-center footer-pagination">
            <div class="text-muted fw-bold">Hiển thị 1-10 của 20 bản ghi</div>
            <nav>
                <ul class="pagination pagination-sm">
                    <li class="page-item disabled"><a class="page-link" href="#"><i class="fa-solid fa-angle-left"></i></a></li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#"><i class="fa-solid fa-angle-right"></i></a></li>
                </ul>
            </nav>
        </div>
    </div>

    <!-- ==============================================
         MODULE 2: BÁO CÁO TỔNG HỢP MERCHANT (NEW)
         ============================================== -->
    <div id="section-report" class="d-none-custom">
        <div class="page-title-bar shadow-sm" style="background-color: #2c3e50; border-left-color: #1a252f;">
            <i class="fa-solid fa-chart-line me-2"></i> BÁO CÁO TỔNG HỢP MERCHANT
        </div>

        <div class="container-fluid filter-section">
            <div class="filter-toggle-container d-md-none">
                <button class="btn btn-filter-toggle" onclick="toggleFilter('filter-report')">
                    <span><i class="fa-solid fa-filter me-2"></i> Bộ lọc báo cáo</span>
                    <i class="fa-solid fa-chevron-down icon-toggle"></i>
                </button>
            </div>

            <div id="filter-report" class="filter-content-wrapper">
                <!-- Row 1 -->
                <div class="row align-items-center mb-2">
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-store"></i> Loại Mer</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option><option>Cá nhân</option><option>Doanh nghiệp</option></select></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-plug"></i> Loại tích hợp</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option><option>Website</option><option>App</option><option>POS</option></select></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-regular fa-calendar-days"></i> Từ Ngày</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><div class="input-group"><input type="text" class="form-control" value="01/01/2026"><span class="input-group-text bg-white"><i class="fa-solid fa-calendar text-primary"></i></span></div></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-regular fa-calendar-days"></i> Đến Ngày</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><div class="input-group"><input type="text" class="form-control" value="31/01/2026"><span class="input-group-text bg-white"><i class="fa-solid fa-calendar text-primary"></i></span></div></div>
                </div>
                
                <!-- Row 2 -->
                <div class="row align-items-center mb-2">
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-signature"></i> Tên Mer</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><input type="text" class="form-control" placeholder="Tên Merchant..."></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-user-tag"></i> TK Merchant</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><input type="text" class="form-control" placeholder="Tài khoản Merchant..."></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label highlight-new-label"><i class="fa-solid fa-store"></i> Sub-Mer</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><input type="text" class="form-control highlight-new-field" placeholder="TK Sub-Merchant..."></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-dungeon"></i> Cổng</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option><option>VTC Pay</option><option>ZaloPay</option><option>Momo</option></select></div>
                </div>

                <!-- Row 3 -->
                <div class="row align-items-center mb-2">
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-building-columns"></i> Ngân hàng</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option><option>Vietcombank</option><option>Techcombank</option><option>MB Bank</option></select></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-regular fa-credit-card"></i> Thẻ TT</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option><option>Visa</option><option>MasterCard</option><option>ATM Nội địa</option></select></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-globe"></i> Phạm vi</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option><option>Nội địa</option><option>Quốc tế</option></select></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-database"></i> Kiểu DL</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tổng hợp</option><option>Chi tiết</option></select></div>
                </div>

                <!-- Row 4 -->
                <div class="row align-items-center mb-2">
                     <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-credit-card"></i> Bin TT</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><input type="text" class="form-control" placeholder="Bin thanh toán..."></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-file-contract"></i> Nhóm HĐ</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option><option>Nhóm A</option><option>Nhóm B</option></select></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-chart-pie"></i> Biểu đồ</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Không hiện</option><option>Biểu đồ cột</option><option>Biểu đồ tròn</option></select></div>
                    
                    <div class="col-lg-3"></div>
                </div>
                
                <div class="text-center mt-3 mb-3 pb-2 border-bottom">
                     <button class="btn-search ripple"><i class="fa-solid fa-magnifying-glass me-1"></i> Tìm kiếm</button>
                </div>
            </div>
        </div>

        <div class="d-flex justify-content-between align-items-center action-toolbar rounded mx-3">
            <div class="toolbar-left d-flex flex-wrap">
                <button class="btn toolbar-btn"><i class="fa-solid fa-cloud-arrow-down text-primary"></i> Xuất dữ liệu</button>
                <button class="btn toolbar-btn"><i class="fa-solid fa-bars text-primary"></i> Hiện 10 dòng</button>
                <button class="btn toolbar-btn"><i class="fa-solid fa-eye-slash text-primary"></i> Ẩn/hiện cột</button>
            </div>
            <div class="toolbar-right d-flex align-items-center">
                <span class="me-2 fw-bold text-secondary" style="font-size: 12px; white-space: nowrap;">Tìm nhanh:</span>
                <input type="text" class="form-control form-control-sm" placeholder="Nhập từ khóa...">
            </div>
        </div>

        <div class="table-responsive-custom">
            <table id="table-report" class="table table-bordered table-striped table-hover align-middle">
                <thead>
                    <tr>
                        <th class="text-center" style="width: 50px;">STT</th>
                        <th>Merchant</th>
                        <th>Số TK Merchant</th>
                        <th class="highlight-new-col-header">Số TK Sub-Merchant</th>
                        <th class="text-end">Số giao dịch</th>
                        <th class="text-end">Giá trị giao dịch (1)</th>
                        <th class="text-end">Phí KH chịu (2)</th>
                        <th class="text-end">Phí merchant chịu (3)</th>
                        <th class="text-end" title="(1)+(2)-(6)-(7)">Số tiền KH chịu (4)</th>
                        <th class="text-end" title="(1)-(3)">Số tiền Merchant nhận (5)</th>
                        <th class="text-end">Số tiền chiết khấu (6)</th>
                        <th class="text-end">Số tiền giảm giá (7)</th>
                        <th class="text-center sticky-col-right" style="width: 80px;">Chức Năng</th>
                    </tr>
                </thead>
                <tbody id="tbody-report"></tbody>
                <tfoot class="fw-bold bg-light">
                    <tr>
                        <td colspan="4" class="text-end">TỔNG CỘNG:</td>
                        <td class="text-end text-primary" id="sum-count">0</td>
                        <td class="text-end text-success" id="sum-val">0</td>
                        <td class="text-end text-danger" id="sum-fee-cust">0</td>
                        <td class="text-end text-danger" id="sum-fee-merch">0</td>
                        <td class="text-end text-primary" id="sum-cust-pay">0</td>
                        <td class="text-end text-success" id="sum-merch-recv">0</td>
                        <td class="text-end text-muted" id="sum-discount">0</td>
                        <td class="text-end text-muted" id="sum-promo">0</td>
                        <td class="sticky-col-right"></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        
        <div class="d-flex justify-content-between align-items-center footer-pagination">
            <div class="text-muted fw-bold">Hiển thị 1-5 của 5 bản ghi tổng hợp</div>
            <nav>
                <ul class="pagination pagination-sm">
                    <li class="page-item disabled"><a class="page-link" href="#"><i class="fa-solid fa-angle-left"></i></a></li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item disabled"><a class="page-link" href="#"><i class="fa-solid fa-angle-right"></i></a></li>
                </ul>
            </nav>
        </div>
    </div>

    <script>
        // --- LOGIC CHUYỂN TAB ---
        function switchTab(tabName) {
            // Update Nav Styles
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active-tab'));
            document.getElementById('nav-' + tabName).classList.add('active-tab');

            // Show/Hide Sections
            document.getElementById('section-approval').classList.add('d-none-custom');
            document.getElementById('section-report').classList.add('d-none-custom');
            
            document.getElementById('section-' + tabName).classList.remove('d-none-custom');
            
            // Re-init resizers for visible table
            setTimeout(initColumnResize, 100);
        }

        // --- LOGIC FILTER MOBILE ---
        function toggleFilter(id) {
            const content = document.getElementById(id);
            const parent = content.parentElement;
            const icon = parent.querySelector('.icon-toggle');
            
            content.classList.toggle('show');
            
            if(content.classList.contains('show')) {
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-up');
            } else {
                icon.classList.remove('fa-chevron-up');
                icon.classList.add('fa-chevron-down');
            }
        }

        // --- DATA MODULE 1: DUYỆT TIỀN CÔNG ---
        const approvalData = [
             {
                time: "14/01/2026 14:54:37", partner: "20260114145431", order: "1100013338", vtcId: "POR3bd28af1ea02f", 
                transCode: "PG-1000001104", type: "Thanh toán qua Deeplink App", bank: "DeepLinkApp", 
                merchant: "0963465816", subMerchant: "0981234567", name: "Nguyễn Văn A", bankAcc: "", amount: "10,000", bankTrans: "797909", 
                executor: "hangnm", successTime: "14/01/2026 14:57:19", merchType: "", gateway: "ZaloPay", 
                status: "Thành công", actionType: "view"
            },
            {
                time: "14/01/2026 16:44:21", partner: "20260114164155", order: "1100013339", vtcId: "POR3bd28af1ea02f", 
                transCode: "PG-1000001105", type: "Thanh toán chuyển khoản", bank: "NCB", 
                merchant: "0963465816", subMerchant: "", name: "Trần Thị B", bankAcc: "1100013339", amount: "10,000", bankTrans: "1100013339", 
                executor: "System", successTime: "14/01/2026 17:30:11", merchType: "", gateway: "NCB", 
                status: "Hủy", actionType: "none"
            },
            {
                time: "14/01/2026 17:11:19", partner: "20260114171111", order: "1100013340", vtcId: "POR3bd28af1ea02g", 
                transCode: "PG-1000001106", type: "Thanh toán qua Deeplink App", bank: "DeepLinkApp", 
                merchant: "0963465816", subMerchant: "0912345678", name: "Lê Văn C", bankAcc: "", amount: "20,000", bankTrans: "7979091", 
                executor: "hangnm", successTime: "14/01/2026 17:12:47", merchType: "", gateway: "ZaloPay", 
                status: "Thành công", actionType: "view"
            },
            {
                time: "14/01/2026 17:26:56", partner: "20260114172651", order: "1100013342", vtcId: "POR3bd28af1ea02h", 
                transCode: "PG-1000001107", type: "Thanh toán qua Deeplink App", bank: "DeepLinkApp", 
                merchant: "0963465816", subMerchant: "0977654321", name: "", bankAcc: "", amount: "15,000", bankTrans: "", 
                executor: "", successTime: "---", merchType: "", gateway: "ZaloPay", 
                status: "Khởi tạo", actionType: "approve"
            },
            {
                time: "14/01/2026 17:27:16", partner: "20260114172711", order: "1100013343", vtcId: "POR3bd28af1ea02i", 
                transCode: "PG-1000001108", type: "Thanh toán qua Deeplink App", bank: "DeepLinkApp", 
                merchant: "0963465816", subMerchant: "", name: "", bankAcc: "", amount: "30,000", bankTrans: "", 
                executor: "", successTime: "---", merchType: "", gateway: "ZaloPay", 
                status: "Khởi tạo", actionType: "approve"
            },
            {
                time: "14/01/2026 17:29:23", partner: "20260114172625", order: "1100013344", vtcId: "POR3bd28af1ea02j", 
                transCode: "PG-1000001109", type: "Thanh toán qua Deeplink App", bank: "DeepLinkApp", 
                merchant: "0963465816", subMerchant: "0999888777", name: "", bankAcc: "", amount: "10,000", bankTrans: "", 
                executor: "", successTime: "---", merchType: "", gateway: "ZaloPay", 
                status: "Khởi tạo", actionType: "approve"
            },
            {
                time: "14/01/2026 17:29:49", partner: "20260114172910", order: "1100013345", vtcId: "POR3bd28af1ea02k", 
                transCode: "PG-1000001110", type: "Thanh toán qua Deeplink App", bank: "DeepLinkApp", 
                merchant: "0963465816", subMerchant: "", name: "Phạm Văn D", bankAcc: "", amount: "50,000", bankTrans: "", 
                executor: "System", successTime: "14/01/2026 17:40:06", merchType: "", gateway: "ZaloPay", 
                status: "Hủy", actionType: "none"
            },
            {
                time: "14/01/2026 17:33:06", partner: "20260114173256", order: "1100013346", vtcId: "POR76e672d8d6014", 
                transCode: "PG-1000001111", type: "Thanh toán chuyển khoản", bank: "NCB", 
                merchant: "0963465816", subMerchant: "0966555444", name: "", bankAcc: "1100013346", amount: "100,000", bankTrans: "1100013346", 
                executor: "", successTime: "---", merchType: "", gateway: "NCB", 
                status: "Khởi tạo", actionType: "approve"
            },
            {
                time: "14/01/2026 17:38:54", partner: "20260114173849", order: "1100013347", vtcId: "POR3bd28af1ea02l", 
                transCode: "PG-1000001112", type: "Thanh toán qua Deeplink App", bank: "DeepLinkApp", 
                merchant: "0963465816", subMerchant: "", name: "Hoàng Thị E", bankAcc: "", amount: "10,000", bankTrans: "797909133", 
                executor: "hangnm", successTime: "14/01/2026 17:48:30", merchType: "", gateway: "ZaloPay", 
                status: "Đã hoàn tiền", actionType: "none"
            },
            {
                time: "14/01/2026 17:41:03", partner: "20260114174056", order: "1100013348", vtcId: "PORccc938006ef18", 
                transCode: "PG-1000001113", type: "Thanh toán chuyển khoản", bank: "NCB", 
                merchant: "0963465816", subMerchant: "0911222333", name: "", bankAcc: "1100013348", amount: "25,000", bankTrans: "1100013348", 
                executor: "hangnm", successTime: "14/01/2026 17:41:53", merchType: "", gateway: "NCB", 
                status: "Thành công", actionType: "view"
            }
        ];

        // --- DATA MODULE 2: BÁO CÁO (Dữ liệu giả lập 1 trang) ---
        // Fields: STT, Merchant, TK Merch, TK Sub, Count, Value(1), FeeCust(2), FeeMerch(3), CustPay(4), MerchRecv(5), Disc(6), Promo(7)
        const reportData = [
            { id: 1, name: "Shop Mẹ và Bé", merch: "0963465816", subMerch: "0981234567", count: 120, val: 1200000000, feeCust: 0, feeMerch: 12000000, disc: 5000000, promo: 2000000 },
            { id: 2, name: "Tạp hóa Minh Anh", merch: "0912345678", subMerch: "0912345678", count: 50, val: 500000000, feeCust: 2000000, feeMerch: 5000000, disc: 0, promo: 0 },
            { id: 3, name: "Siêu thị Điện máy", merch: "0977654321", subMerch: "", count: 800, val: 3000000000, feeCust: 5000000, feeMerch: 30000000, disc: 15000000, promo: 10000000 },
            { id: 4, name: "Thời trang Nữ", merch: "0999888777", subMerch: "0933444555", count: 200, val: 400000000, feeCust: 0, feeMerch: 4000000, disc: 2000000, promo: 1000000 },
            { id: 5, name: "Nhà sách Phương Nam", merch: "0966555444", subMerch: "0911222333", count: 80, val: 140000000, feeCust: 500000, feeMerch: 1400000, disc: 0, promo: 0 },
        ];

        function formatCurrency(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function renderApproval() {
            const tbody = document.getElementById('tbody-approval');
            let html = '';
            approvalData.forEach(row => {
                let statusClass = '';
                if(row.status === 'Thành công') statusClass = 'status-success';
                else if(row.status === 'Hủy') statusClass = 'status-cancel';
                else if(row.status === 'Khởi tạo') statusClass = 'status-init';
                else if(row.status === 'Đã hoàn tiền') statusClass = 'status-refund';

                let actionHtml = '';
                if(row.actionType === 'view') {
                    actionHtml = `<div class="action-btn-group"><button class="btn-view" title="Xem chi tiết"><i class="fa-regular fa-eye"></i></button></div>`;
                } else if(row.actionType === 'approve') {
                    actionHtml = `
                        <div class="action-btn-group">
                            <button class="btn-check" title="Duyệt"><i class="fa-solid fa-check"></i></button>
                            <button class="btn-cancel" title="Hủy"><i class="fa-solid fa-xmark"></i></button>
                        </div>
                    `;
                }

                html += `
                    <tr>
                        <td class="text-nowrap">${row.time}</td>
                        <td>${row.partner}</td>
                        <td class="fw-bold text-primary">${row.order}</td>
                        <td style="max-width: 100px; overflow: hidden; text-overflow: ellipsis;" title="${row.vtcId}">${row.vtcId}</td>
                        <td>${row.transCode.replace('PG-', 'PG-<br>')}</td>
                        <td>${row.type}</td>
                        <td>${row.bank}</td>
                        <td>${row.merchant}</td>
                        <td class="highlight-new-col-cell">${row.subMerchant}</td>
                        <td>${row.name}</td>
                        <td>${row.bankAcc}</td>
                        <td class="text-end fw-bold">${row.amount}</td>
                        <td>${row.bankTrans}</td>
                        <td>${row.executor}</td>
                        <td class="text-nowrap">${row.successTime}</td>
                        <td>${row.merchType}</td>
                        <td>${row.gateway}</td>
                        <td class="${statusClass}">${row.status}</td>
                        <td class="text-center sticky-col-right">${actionHtml}</td>
                    </tr>
                `;
            });
            tbody.innerHTML = html;
        }

        function renderReport() {
            const tbody = document.getElementById('tbody-report');
            let html = '';
            
            // Variables for footer sums
            let sCount=0, sVal=0, sFeeCust=0, sFeeMerch=0, sCustPay=0, sMerchRecv=0, sDisc=0, sPromo=0;

            reportData.forEach(row => {
                // Calculate derived columns
                // Số tiền KH chịu (4) = (1) + (2) - (6) - (7)
                const custPay = row.val + row.feeCust - row.disc - row.promo;
                // Số tiền Merchant nhận (5) = (1) - (3)
                const merchRecv = row.val - row.feeMerch;

                // Accumulate totals
                sCount += row.count;
                sVal += row.val;
                sFeeCust += row.feeCust;
                sFeeMerch += row.feeMerch;
                sCustPay += custPay;
                sMerchRecv += merchRecv;
                sDisc += row.disc;
                sPromo += row.promo;

                html += `
                    <tr>
                        <td class="text-center">${row.id}</td>
                        <td>${row.name}</td>
                        <td>${row.merch}</td>
                        <td class="highlight-new-col-cell">${row.subMerch}</td>
                        <td class="text-end">${row.count}</td>
                        <td class="text-end fw-bold">${formatCurrency(row.val)}</td>
                        <td class="text-end">${formatCurrency(row.feeCust)}</td>
                        <td class="text-end">${formatCurrency(row.feeMerch)}</td>
                        <td class="text-end fw-bold text-primary">${formatCurrency(custPay)}</td>
                        <td class="text-end fw-bold text-success">${formatCurrency(merchRecv)}</td>
                        <td class="text-end text-muted">${formatCurrency(row.disc)}</td>
                        <td class="text-end text-muted">${formatCurrency(row.promo)}</td>
                        <td class="text-center sticky-col-right">
                             <div class="action-btn-group"><button class="btn-view" title="Xem chi tiết"><i class="fa-regular fa-eye"></i></button></div>
                        </td>
                    </tr>
                `;
            });
            tbody.innerHTML = html;

            // Update footer totals
            document.getElementById('sum-count').innerText = formatCurrency(sCount);
            document.getElementById('sum-val').innerText = formatCurrency(sVal);
            document.getElementById('sum-fee-cust').innerText = formatCurrency(sFeeCust);
            document.getElementById('sum-fee-merch').innerText = formatCurrency(sFeeMerch);
            document.getElementById('sum-cust-pay').innerText = formatCurrency(sCustPay);
            document.getElementById('sum-merch-recv').innerText = formatCurrency(sMerchRecv);
            document.getElementById('sum-discount').innerText = formatCurrency(sDisc);
            document.getElementById('sum-promo').innerText = formatCurrency(sPromo);
        }

        function initColumnResize() {
            // Logic resize chung cho cả 2 bảng
            // Tìm bảng nào đang hiển thị
            const activeTable = !document.getElementById('section-approval').classList.contains('d-none-custom') 
                                ? document.getElementById('table-approval') 
                                : document.getElementById('table-report');

            if(!activeTable) return;

            const headers = activeTable.querySelectorAll('th');
            
            headers.forEach(th => {
                if(th.querySelector('.resizer')) th.querySelector('.resizer').remove();
            });

            headers.forEach((th, index) => {
                if (th.classList.contains('sticky-col-right')) return; // Skip sticky action col

                const resizer = document.createElement('div');
                resizer.classList.add('resizer');
                th.appendChild(resizer);
                
                let x = 0;
                let w = 0;

                const mouseDownHandler = function(e) {
                    x = e.clientX;
                    const styles = window.getComputedStyle(th);
                    w = parseInt(styles.width, 10);
                    document.addEventListener('mousemove', mouseMoveHandler);
                    document.addEventListener('mouseup', mouseUpHandler);
                    resizer.classList.add('resizing');
                };

                const mouseMoveHandler = function(e) {
                    const dx = e.clientX - x;
                    const newWidth = w + dx;
                     if (newWidth > 30) {
                        th.style.width = `${newWidth}px`;
                        th.style.minWidth = `${newWidth}px`;
                    }
                };

                const mouseUpHandler = function() {
                    document.removeEventListener('mousemove', mouseMoveHandler);
                    document.removeEventListener('mouseup', mouseUpHandler);
                    resizer.classList.remove('resizing');
                };

                resizer.addEventListener('mousedown', mouseDownHandler);
            });
        }

        // Init
        renderApproval();
        renderReport();
        initColumnResize();
        
        // Button loading effect
        document.querySelectorAll('.btn-search').forEach(btn => {
            btn.addEventListener('click', function() {
                 const originalHtml = this.innerHTML;
                 this.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Xử lý...';
                 setTimeout(() => {
                     this.innerHTML = originalHtml;
                 }, 800);
            });
        });
    </script>
</body>
</html>

