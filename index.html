<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ Thống Quản Trị VTC Pay</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts: Open Sans -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --vtc-blue: #0068ac;
            --vtc-blue-dark: #005691;
            --header-bg: #f8f9fa;
            --table-header-bg: #e9ecef;
        }

        body {
            font-family: "Helvetica Neue", Helvetica, Arial, "Open Sans", sans-serif;
            background-color: #fff;
            font-size: 13px;
        }

        /* Highlight Styles for New Fields */
        .highlight-new-field {
            border: 2px dashed #dc3545 !important; /* Red dashed border */
            background-color: #fff5f5 !important;
        }
        
        .highlight-new-label {
            color: #dc3545 !important;
            font-weight: bold;
            text-decoration: underline;
            text-decoration-style: dashed;
        }

        .highlight-new-col-header {
            background-color: #ffe6e6 !important;
            color: #dc3545 !important;
            border-bottom: 2px dashed #dc3545 !important;
            border-left: 2px dashed #dc3545 !important;
            border-right: 2px dashed #dc3545 !important;
        }

        .highlight-new-col-cell {
            background-color: #fff5f5 !important;
            border-left: 2px dashed #ffcccc !important;
            border-right: 2px dashed #ffcccc !important;
            color: #dc3545;
            font-weight: 600;
        }

        /* Top Navbar Responsive */
        .top-nav {
            background-color: #fff;
            border-bottom: 1px solid #ddd;
            padding: 10px 15px;
            color: #333;
            position: relative;
            z-index: 1000;
        }

        .logo-text {
            font-weight: 800;
            font-size: 24px;
            color: var(--vtc-blue);
            font-style: italic;
            text-decoration: none;
            white-space: nowrap;
        }
        
        .nav-btn {
            background-color: var(--vtc-blue);
            color: white;
            border: none;
            border-radius: 3px;
            padding: 6px 12px;
            margin: 2px;
            font-size: 13px;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            cursor: pointer;
            text-decoration: none;
        }
        
        .nav-btn:hover {
            background-color: var(--vtc-blue-dark);
            color: white;
        }

        .nav-btn.active-tab {
            background-color: var(--vtc-blue-dark);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .nav-dropdown .dropdown-toggle::after {
            margin-left: 0.5em;
        }
        .nav-dropdown .dropdown-menu {
            font-size: 13px;
            border-radius: 0;
            margin-top: 5px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 1px solid #ddd;
        }
        .nav-dropdown .dropdown-item:active, .nav-dropdown .dropdown-item.active {
            background-color: var(--vtc-blue);
        }
        .nav-dropdown .dropdown-item {
            padding: 8px 15px;
            cursor: pointer;
        }

        .user-info {
            color: var(--vtc-blue);
            font-weight: 500;
            white-space: nowrap;
        }
        
        .logout-btn {
            color: #dc3545 !important;
            transition: opacity 0.2s;
        }
        .logout-btn:hover {
            opacity: 0.7;
        }

        .page-title-bar {
            background-color: #337ab7;
            color: white;
            padding: 10px 15px;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 20px;
            border-left: 5px solid #1b5480;
            font-size: 14px;
        }

        .filter-section {
            padding: 0 15px;
            margin-bottom: 20px;
            background-color: #fff;
        }
        
        .filter-toggle-container {
            display: none;
            margin-bottom: 10px;
        }
        .btn-filter-toggle {
            width: 100%;
            text-align: left;
            background-color: #f0f7ff;
            color: #0068ac;
            border: 1px solid #cce5ff;
            font-weight: 600;
            padding: 8px 15px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .filter-label {
            font-weight: 600;
            color: #0068ac;
            display: flex;
            align-items: center;
            font-size: 13px;
            padding-top: 6px;
            white-space: nowrap;
        }
        
        .filter-label i {
            margin-right: 6px;
            width: 16px;
            text-align: center;
        }

        .form-control, .form-select {
            font-size: 13px;
            border-radius: 3px;
            padding: 5px 8px;
        }

        .btn-search {
            background-color: #26b6d4;
            color: white;
            border: none;
            padding: 8px 30px;
            border-radius: 3px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: background 0.2s;
        }
        
        .btn-search:hover {
            background-color: #1a9cb7;
            color: white;
        }

        .action-toolbar {
            padding: 10px 15px;
            margin-bottom: 10px;
            background-color: #f8f9fa;
            border-top: 1px solid #eee;
            border-bottom: 1px solid #eee;
        }

        .toolbar-btn {
            font-size: 12px;
            margin-right: 5px;
            background-color: #fff;
            border: 1px solid #ccc;
            color: #333;
            margin-bottom: 5px;
        }
        
        .toolbar-btn:hover {
            background-color: #e2e6ea;
        }

        /* UPDATED: Table Responsive & Text Wrapping */
        .table {
            font-size: 12px;
            margin-bottom: 0;
            border-collapse: separate;
            border-spacing: 0;
            /* Allow wrapping */
            white-space: normal; 
            word-wrap: break-word;
        }

        .table th, .table td {
            white-space: normal !important; /* Force text to wrap */
            word-break: break-word; /* Break long words if necessary */
            vertical-align: middle;
            padding: 8px;
            border-bottom: 1px solid #dee2e6;
        }

        .table-responsive-custom {
            padding: 0 15px;
            margin-bottom: 20px;
            width: 100%;
            overflow-x: auto; /* Enable horizontal scroll for table container only */
            -webkit-overflow-scrolling: touch;
            position: relative;
        }

        .table thead th {
            background-color: #dff0d8;
            vertical-align: middle;
            text-align: center;
            border-bottom: 2px solid #aeccae;
            border-top: 1px solid #dee2e6;
            color: #333;
            font-weight: bold;
            padding: 10px 8px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .sticky-col-right {
            position: sticky;
            right: 0;
            z-index: 5;
            border-left: 2px solid #dee2e6;
            box-shadow: -4px 0 8px rgba(0,0,0,0.08);
            clip-path: inset(0px -15px 0px 0px);
        }
        
        thead th.sticky-col-right {
            background-color: #dff0d8 !important;
            z-index: 15;
        }
        
        tbody td.sticky-col-right {
            background-color: #fff;
        }
        
        .table-striped tbody tr:nth-of-type(odd) td.sticky-col-right {
            background-color: #f9f9f9;
        }
        .table-striped tbody tr:hover td.sticky-col-right {
            background-color: #e8f4fd;
        }

        .resizer {
            position: absolute;
            top: 0;
            right: 0;
            width: 5px;
            cursor: col-resize;
            user-select: none;
            height: 100%;
            z-index: 20;
            background-color: transparent; 
        }

        .resizer:hover, .resizing {
            background-color: #00a0e3; 
            width: 4px;
        }
        
        .table-striped tbody tr:nth-of-type(odd) {
            background-color: #f9f9f9;
        }

        .status-success { color: #28a745; font-weight: 500; }
        .status-cancel { color: #dc3545; }
        .status-init { color: #6c757d; font-style: italic;}
        .status-refund { color: #fd7e14; }

        .action-btn-group button {
            margin: 0 2px;
            padding: 3px 8px;
            font-size: 11px;
            border-radius: 3px;
            border: none;
            color: white;
            transition: opacity 0.2s;
        }
        
        .action-btn-group button:hover { opacity: 0.85; }
        .btn-view { background-color: #f0ad4e; }
        .btn-check { background-color: #0d6efd; }
        .btn-cancel { background-color: #dc3545; }

        .footer-pagination {
            padding: 15px;
            background-color: #f8f9fa;
            border-top: 1px solid #ddd;
            font-size: 12px;
        }

        .pagination { margin-bottom: 0; }
        .page-link { color: #337ab7; }
        .page-item.active .page-link { background-color: #337ab7; border-color: #337ab7; }

        .d-none-custom {
            display: none !important;
        }

        @media (max-width: 992px) {
            .filter-label { margin-bottom: 4px; }
            .col-form-container { margin-bottom: 10px; }
            .logo-text { font-size: 20px; }

            /* Force Table to Card View on Mobile */
            .table-responsive-custom { overflow-x: hidden; } 
            
            .table, .table thead, .table tbody, .table th, .table td, .table tr { 
                display: block; 
            }
            
            .table thead tr { 
                position: absolute;
                top: -9999px;
                left: -9999px;
            }
            
            .table tr { 
                border: 1px solid #ccc; 
                margin-bottom: 15px; 
                border-radius: 5px;
                background-color: #fff;
                box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            }
            
            .table td { 
                border: none;
                border-bottom: 1px solid #eee; 
                position: relative;
                padding-left: 50% !important; 
                text-align: right !important;
                white-space: normal !important;
                min-height: 35px;
            }
            
            .table td:before { 
                position: absolute;
                top: 8px;
                left: 10px;
                width: 45%; 
                padding-right: 10px; 
                white-space: nowrap;
                text-align: left;
                font-weight: bold;
                content: attr(data-label);
                color: #0068ac;
            }
            
            .sticky-col-right {
                position: static !important;
                box-shadow: none !important;
                border-left: none !important;
                background-color: transparent !important;
            }
            
            .table td:last-child {
                border-bottom: 0;
                padding-left: 10px !important;
                text-align: center !important;
                background-color: #f8f9fa;
            }
            .table td:last-child:before {
                display: none;
            }
            
            .resizer { display: none; }
        }

        @media (max-width: 768px) {
            .top-nav { flex-direction: column; align-items: flex-start !important; gap: 10px; }
            
            .nav-menu-container { 
                width: 100%; 
                display: flex; 
                flex-wrap: nowrap !important;
                gap: 8px; 
                margin-left: 0 !important; 
                margin-top: 5px;
                overflow-x: auto;
                padding-bottom: 5px;
                -webkit-overflow-scrolling: touch;
            }
            
            .nav-btn, .dropdown-toggle {
                flex: 0 0 auto;
                white-space: nowrap;
            }

            .user-info-container { width: 100%; justify-content: space-between; margin-top: 5px; border-top: 1px solid #eee; padding-top: 5px;}
            
            .action-toolbar { flex-direction: column; align-items: flex-start; gap: 10px; }
            .toolbar-right { width: 100%; }
            .toolbar-right input { flex-grow: 1; }
            
            .footer-pagination { flex-direction: column; gap: 10px; align-items: center; }

            .filter-toggle-container { display: block; }
            .filter-content-wrapper { display: none; }
            .filter-content-wrapper.show { display: block; animation: slideDown 0.3s ease-out; }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

    <!-- Header Section -->
    <div class="d-flex justify-content-between align-items-center top-nav">
        <div class="d-flex align-items-center flex-wrap w-100 overflow-hidden" style="overflow: visible !important;">
            <a href="#" class="logo-text me-3 flex-shrink-0">
                <i class="fa-solid fa-wifi fa-rotate-90 me-1" style="font-size: 18px;"></i>VTC<span style="color: #00a0e3">Pay</span>
            </a>
            
            <!-- Navigation Menu with Dropdown -->
            <div class="ms-md-3 nav-menu-container d-flex align-items-center">
                <button id="nav-approval" class="nav-btn active-tab me-1" onclick="switchTab('approval')">
                    <i class="fa-solid fa-money-bill me-2"></i> 
                    Duyệt tiền công
                </button>
                
                <!-- Giao dịch Dropdown (New Structure) -->
                <div class="dropdown nav-dropdown d-inline-block me-1">
                    <button class="nav-btn dropdown-toggle" type="button" id="transactionDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fa-solid fa-money-check-dollar me-2"></i> Giao dịch
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="transactionDropdown">
                        <li>
                            <a class="dropdown-item" href="Chi_ho.html">
                                <i class="fa-solid fa-money-bill-transfer me-2 text-success"></i> Chuyển tiền chi hộ
                            </a>
                        </li>
                    </ul>
                </div>

                <!-- Báo cáo Dropdown -->
                <div class="dropdown nav-dropdown d-inline-block">
                    <button class="nav-btn dropdown-toggle" type="button" id="reportDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fa-solid fa-chart-pie me-2"></i> Báo cáo
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="reportDropdown">
                        <li><a class="dropdown-item" id="nav-report" onclick="switchTab('report')"><i class="fa-solid fa-chart-bar me-2 text-primary"></i>Tổng hợp Merchant</a></li>
                        <li><a class="dropdown-item" id="nav-detail-report" onclick="switchTab('detail-report')"><i class="fa-solid fa-list-check me-2 text-success"></i>Chi tiết Merchant</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" id="nav-refund-report" onclick="switchTab('refund-report')"><i class="fa-solid fa-rotate-left me-2 text-danger"></i>Hoàn tiền tổng hợp</a></li>
                        <li><a class="dropdown-item" id="nav-refund-detail-report" onclick="switchTab('refund-detail-report')"><i class="fa-solid fa-file-invoice-dollar me-2 text-warning"></i>Hoàn tiền chi tiết</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="Report_chi_ho.html"><i class="fa-solid fa-file-invoice text-info me-2"></i>Báo cáo Chuyển tiền chi hộ</a></li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- User Info -->
        <div class="d-flex align-items-center user-info-container ms-3">
            <span class="user-info me-2"><i class="fa-solid fa-circle-user me-1"></i> hongtt</span>
            <a href="#" class="logout-btn" title="Đăng xuất"><i class="fa-solid fa-right-from-bracket"></i></a>
        </div>
    </div>

    <!-- ==============================================
         MODULE 1: DUYỆT TIỀN CÔNG THANH TOÁN (DEFAULT)
         ============================================== -->
    <div id="section-approval">
        <div class="page-title-bar shadow-sm">
            <i class="fa-solid fa-dollar-sign me-2"></i> DUYỆT TIỀN CÔNG THANH TOÁN
        </div>

        <div class="container-fluid filter-section">
            <div class="filter-toggle-container d-md-none">
                <button class="btn btn-filter-toggle" onclick="toggleFilter('filter-approval')">
                    <span><i class="fa-solid fa-filter me-2"></i> Bộ lọc tìm kiếm</span>
                    <i class="fa-solid fa-chevron-down icon-toggle"></i>
                </button>
            </div>

            <div id="filter-approval" class="filter-content-wrapper">
                <div class="row align-items-center mb-2">
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-regular fa-calendar-days"></i> Từ Ngày</label></div>
                    <div class="col-lg-3 col-md-6 mb-2">
                        <div class="input-group"><input type="text" class="form-control" value="14/01/2026 10:55"><span class="input-group-text bg-white"><i class="fa-solid fa-calendar text-primary"></i></span></div>
                    </div>
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-regular fa-calendar-days"></i> Đến Ngày</label></div>
                    <div class="col-lg-3 col-md-6 mb-2">
                        <div class="input-group"><input type="text" class="form-control" value="21/01/2026 23:59"><span class="input-group-text bg-white"><i class="fa-solid fa-calendar text-primary"></i></span></div>
                    </div>
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-barcode"></i> Mã đơn</label></div>
                    <div class="col-lg-3 col-md-12 mb-2"><input type="text" class="form-control" placeholder="Nhập mã đơn hàng..."></div>
                </div>
                
                <div class="row align-items-center mb-2">
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-regular fa-id-card"></i> Mã đối tác</label></div>
                    <div class="col-lg-3 col-md-6 mb-2"><input type="text" class="form-control"></div>
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-wallet"></i> TK VTCPay</label></div>
                    <div class="col-lg-3 col-md-6 mb-2"><input type="text" class="form-control"></div>
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-building-columns"></i> TK Ngân hàng</label></div>
                    <div class="col-lg-3 col-md-12 mb-2"><input type="text" class="form-control"></div>
                </div>

                <div class="row align-items-center mb-2">
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-money-check"></i> Loại GD</label></div>
                    <div class="col-lg-3 col-md-6 mb-2"><select class="form-select"><option>Tất Cả</option><option>Thanh toán qua Deeplink App</option><option>Thanh toán chuyển khoản</option></select></div>
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-building"></i> Ngân Hàng</label></div>
                    <div class="col-lg-3 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option><option>NCB</option><option>ZaloPay</option></select></div>
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-filter"></i> Trạng thái</label></div>
                    <div class="col-lg-3 col-md-12 mb-2"><select class="form-select"><option>Tất Cả</option><option>Thành công</option><option>Hủy</option><option>Khởi tạo</option></select></div>
                </div>

                <div class="row align-items-center mb-2">
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-network-wired"></i> Kênh</label></div>
                    <div class="col-lg-3 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option></select></div>
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-hashtag"></i> VtcTransID</label></div>
                    <div class="col-lg-3 col-md-6 mb-2"><input type="text" class="form-control"></div>
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label highlight-new-label"><i class="fa-solid fa-store"></i> Sub-Mer</label></div>
                    <div class="col-lg-3 col-md-12 mb-2"><input type="text" class="form-control highlight-new-field" placeholder="Nhập TK Sub-Merchant"></div>
                </div>
                
                <div class="text-center mt-3 mb-3 pb-2 border-bottom">
                     <button class="btn-search ripple"><i class="fa-solid fa-magnifying-glass me-1"></i> Tra Cứu</button>
                </div>
            </div>
        </div>

        <div class="d-flex justify-content-between align-items-center action-toolbar rounded mx-3">
            <div class="toolbar-left d-flex flex-wrap">
                <button class="btn toolbar-btn"><i class="fa-solid fa-cloud-arrow-down text-primary"></i> Xuất dữ liệu</button>
                <button class="btn toolbar-btn"><i class="fa-solid fa-bars text-primary"></i> Hiện 10 dòng</button>
                <button class="btn toolbar-btn"><i class="fa-solid fa-eye-slash text-primary"></i> Ẩn/hiện cột</button>
            </div>
            <div class="toolbar-right d-flex align-items-center">
                <span class="me-2 fw-bold text-secondary" style="font-size: 12px; white-space: nowrap;">Tìm nhanh:</span>
                <input type="text" class="form-control form-control-sm" placeholder="Nhập từ khóa...">
            </div>
        </div>

        <div class="table-responsive-custom">
            <table id="table-approval" class="table table-bordered table-striped table-hover align-middle">
                <thead>
                    <tr>
                        <th>Thời gian</th>
                        <th>Mã đối tác</th>
                        <th>Mã Đơn Hàng</th>
                        <th>VtcTransID</th>
                        <th>Mã GD</th>
                        <th>Loại giao dịch</th>
                        <th>Ngân Hàng</th>
                        <th>TK Merchant</th>
                        <th class="highlight-new-col-header">TK Sub-Merchant</th>
                        <th>Tên đầy đủ</th>
                        <th>TK Ngân Hàng</th>
                        <th>Số Tiền</th>
                        <th>Mã GD Ngân hàng</th>
                        <th>Người thực hiện</th>
                        <th>TG thành công</th>
                        <th>Loại merchant</th>
                        <th>Cổng kết nối</th>
                        <th>Trạng thái</th>
                        <th class="text-center sticky-col-right">Chức Năng</th>
                    </tr>
                </thead>
                <tbody id="tbody-approval"></tbody>
            </table>
        </div>

        <div class="d-flex justify-content-between align-items-center footer-pagination">
            <div class="text-muted fw-bold">Hiển thị 1-10 của 20 bản ghi</div>
            <nav>
                <ul class="pagination pagination-sm">
                    <li class="page-item disabled"><a class="page-link" href="#"><i class="fa-solid fa-angle-left"></i></a></li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#"><i class="fa-solid fa-angle-right"></i></a></li>
                </ul>
            </nav>
        </div>
    </div>

    <!-- ==============================================
         MODULE 2: BÁO CÁO TỔNG HỢP MERCHANT
         ============================================== -->
    <div id="section-report" class="d-none-custom">
        <div class="page-title-bar shadow-sm">
            <i class="fa-solid fa-chart-line me-2"></i> BÁO CÁO TỔNG HỢP MERCHANT
        </div>

        <div class="container-fluid filter-section">
            <div class="filter-toggle-container d-md-none">
                <button class="btn btn-filter-toggle" onclick="toggleFilter('filter-report')">
                    <span><i class="fa-solid fa-filter me-2"></i> Bộ lọc báo cáo</span>
                    <i class="fa-solid fa-chevron-down icon-toggle"></i>
                </button>
            </div>

            <div id="filter-report" class="filter-content-wrapper">
                <!-- Row 1 -->
                <div class="row align-items-center mb-2">
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-store"></i> Loại Mer</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option><option>Cá nhân</option><option>Doanh nghiệp</option></select></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-plug"></i> Loại tích hợp</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option><option>Website</option><option>App</option><option>POS</option></select></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-regular fa-calendar-days"></i> Từ Ngày</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><div class="input-group"><input type="text" class="form-control" value="01/01/2026"><span class="input-group-text bg-white"><i class="fa-solid fa-calendar text-primary"></i></span></div></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-regular fa-calendar-days"></i> Đến Ngày</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><div class="input-group"><input type="text" class="form-control" value="31/01/2026"><span class="input-group-text bg-white"><i class="fa-solid fa-calendar text-primary"></i></span></div></div>
                </div>
                
                <!-- Row 2 -->
                <div class="row align-items-center mb-2">
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-signature"></i> Tên Mer</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><input type="text" class="form-control" placeholder="Tên Merchant..."></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-user-tag"></i> TK Merchant</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><input type="text" class="form-control" placeholder="Tài khoản Merchant..."></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label highlight-new-label"><i class="fa-solid fa-store"></i> Sub-Mer</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><input type="text" class="form-control highlight-new-field" placeholder="TK Sub-Merchant..."></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-dungeon"></i> Cổng</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option><option>VTC Pay</option><option>ZaloPay</option><option>Momo</option></select></div>
                </div>

                <!-- Row 3 -->
                <div class="row align-items-center mb-2">
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-building-columns"></i> Ngân hàng</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option><option>Vietcombank</option><option>Techcombank</option><option>MB Bank</option></select></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-regular fa-credit-card"></i> Thẻ TT</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option><option>Visa</option><option>MasterCard</option><option>ATM Nội địa</option></select></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-globe"></i> Phạm vi</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option><option>Nội địa</option><option>Quốc tế</option></select></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-database"></i> Kiểu DL</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tổng hợp</option><option>Chi tiết</option></select></div>
                </div>

                <!-- Row 4 -->
                <div class="row align-items-center mb-2">
                     <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-credit-card"></i> Bin TT</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><input type="text" class="form-control" placeholder="Bin thanh toán..."></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-file-contract"></i> Nhóm HĐ</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option><option>Nhóm A</option><option>Nhóm B</option></select></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-chart-pie"></i> Biểu đồ</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Không hiện</option><option>Biểu đồ cột</option><option>Biểu đồ tròn</option></select></div>
                    
                    <div class="col-lg-3"></div>
                </div>
                
                <div class="text-center mt-3 mb-3 pb-2 border-bottom">
                     <button class="btn-search ripple"><i class="fa-solid fa-magnifying-glass me-1"></i> Tìm kiếm</button>
                </div>
            </div>
        </div>

        <div class="d-flex justify-content-between align-items-center action-toolbar rounded mx-3">
            <div class="toolbar-left d-flex flex-wrap">
                <button class="btn toolbar-btn"><i class="fa-solid fa-cloud-arrow-down text-primary"></i> Xuất dữ liệu</button>
                <button class="btn toolbar-btn"><i class="fa-solid fa-bars text-primary"></i> Hiện 10 dòng</button>
                <button class="btn toolbar-btn"><i class="fa-solid fa-eye-slash text-primary"></i> Ẩn/hiện cột</button>
            </div>
            <div class="toolbar-right d-flex align-items-center">
                <span class="me-2 fw-bold text-secondary" style="font-size: 12px; white-space: nowrap;">Tìm nhanh:</span>
                <input type="text" class="form-control form-control-sm" placeholder="Nhập từ khóa...">
            </div>
        </div>

        <div class="table-responsive-custom">
            <table id="table-report" class="table table-bordered table-striped table-hover align-middle">
                <thead>
                    <tr>
                        <th class="text-center" style="width: 50px;">STT</th>
                        <th>Merchant</th>
                        <th>Số TK Merchant</th>
                        <th class="highlight-new-col-header">Số TK Sub-Merchant</th>
                        <th class="text-end">Số giao dịch</th>
                        <th class="text-end">Giá trị giao dịch (1)</th>
                        <th class="text-end">Phí KH chịu (2)</th>
                        <th class="text-end">Phí merchant chịu (3)</th>
                        <th class="text-end" title="(1)+(2)-(6)-(7)">Số tiền KH chịu (4)</th>
                        <th class="text-end" title="(1)-(3)">Số tiền Merchant nhận (5)</th>
                        <th class="text-end">Số tiền chiết khấu (6)</th>
                        <th class="text-end">Số tiền giảm giá (7)</th>
                        <th class="text-center sticky-col-right" style="width: 80px;">Chức Năng</th>
                    </tr>
                </thead>
                <tbody id="tbody-report"></tbody>
                <tfoot class="fw-bold bg-light">
                    <tr>
                        <td colspan="4" class="text-end">TỔNG CỘNG:</td>
                        <td class="text-end text-primary" id="sum-count">0</td>
                        <td class="text-end text-success" id="sum-val">0</td>
                        <td class="text-end text-danger" id="sum-fee-cust">0</td>
                        <td class="text-end text-danger" id="sum-fee-merch">0</td>
                        <td class="text-end text-primary" id="sum-cust-pay">0</td>
                        <td class="text-end text-success" id="sum-merch-recv">0</td>
                        <td class="text-end text-muted" id="sum-discount">0</td>
                        <td class="text-end text-muted" id="sum-promo">0</td>
                        <td class="sticky-col-right"></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        
        <div class="d-flex justify-content-between align-items-center footer-pagination">
            <div class="text-muted fw-bold">Hiển thị 1-5 của 5 bản ghi tổng hợp</div>
            <nav>
                <ul class="pagination pagination-sm">
                    <li class="page-item disabled"><a class="page-link" href="#"><i class="fa-solid fa-angle-left"></i></a></li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item disabled"><a class="page-link" href="#"><i class="fa-solid fa-angle-right"></i></a></li>
                </ul>
            </nav>
        </div>
    </div>

    <!-- ==============================================
         MODULE 3: BÁO CÁO CHI TIẾT MERCHANT
         ============================================== -->
    <div id="section-detail-report" class="d-none-custom">
        <div class="page-title-bar shadow-sm">
            <i class="fa-solid fa-list-check me-2"></i> BÁO CÁO CHI TIẾT MERCHANT
        </div>

        <div class="container-fluid filter-section">
            <div class="filter-toggle-container d-md-none">
                <button class="btn btn-filter-toggle" onclick="toggleFilter('filter-detail-report')">
                    <span><i class="fa-solid fa-filter me-2"></i> Bộ lọc chi tiết</span>
                    <i class="fa-solid fa-chevron-down icon-toggle"></i>
                </button>
            </div>

            <div id="filter-detail-report" class="filter-content-wrapper">
                <!-- Row 1 -->
                <div class="row align-items-center mb-2">
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-store"></i> Loại Mer</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option><option>Cá nhân</option><option>Doanh nghiệp</option></select></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-plug"></i> Loại tích hợp</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option><option>Website</option><option>App</option><option>POS</option></select></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-signature"></i> Tên Mer</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><input type="text" class="form-control" placeholder="Tên Merchant..."></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-user-tag"></i> TK Merchant</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><input type="text" class="form-control" placeholder="Tài khoản Merchant..."></div>
                </div>
                
                <!-- Row 2 -->
                <div class="row align-items-center mb-2">
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label highlight-new-label"><i class="fa-solid fa-store"></i> Sub-Mer</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><input type="text" class="form-control highlight-new-field" placeholder="TK Sub-Merchant..."></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-user"></i> TK KH</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><input type="text" class="form-control" placeholder="Tài khoản KH..."></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-regular fa-credit-card"></i> Thẻ TT</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option><option>Visa</option><option>MasterCard</option><option>ATM Nội địa</option></select></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-money-check-dollar"></i> PT TT</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option><option>Ví điện tử</option><option>Thẻ quốc tế</option><option>Thẻ nội địa</option></select></div>
                </div>

                <!-- Row 3 -->
                <div class="row align-items-center mb-2">
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-credit-card"></i> Loại Bin</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option></select></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-file-contract"></i> Nhóm HĐ</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option><option>Nhóm A</option><option>Nhóm B</option></select></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-eye"></i> Kiểu xem</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Mặc định</option></select></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-filter"></i> Trạng thái</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option><option>Thành công</option><option>Thất bại</option></select></div>
                </div>

                <!-- Row 4 -->
                <div class="row align-items-center mb-2">
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-network-wired"></i> Kênh KN</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option></select></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-building-columns"></i> Ngân hàng</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option></select></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-regular fa-calendar-days"></i> Từ Ngày</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><div class="input-group"><input type="text" class="form-control" value="01/01/2026"><span class="input-group-text bg-white"><i class="fa-solid fa-calendar text-primary"></i></span></div></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-regular fa-calendar-days"></i> Đến Ngày</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><div class="input-group"><input type="text" class="form-control" value="31/01/2026"><span class="input-group-text bg-white"><i class="fa-solid fa-calendar text-primary"></i></span></div></div>
                </div>
                
                <div class="text-center mt-3 mb-3 pb-2 border-bottom">
                     <button class="btn-search ripple"><i class="fa-solid fa-magnifying-glass me-1"></i> Tìm kiếm</button>
                </div>
            </div>
        </div>

        <div class="d-flex justify-content-between align-items-center action-toolbar rounded mx-3">
            <div class="toolbar-left d-flex flex-wrap">
                <button class="btn toolbar-btn"><i class="fa-solid fa-cloud-arrow-down text-primary"></i> Xuất dữ liệu</button>
                <button class="btn toolbar-btn"><i class="fa-solid fa-bars text-primary"></i> Hiện 10 dòng</button>
                <button class="btn toolbar-btn"><i class="fa-solid fa-eye-slash text-primary"></i> Ẩn/hiện cột</button>
            </div>
            <div class="toolbar-right d-flex align-items-center">
                <span class="me-2 fw-bold text-secondary" style="font-size: 12px; white-space: nowrap;">Tìm nhanh:</span>
                <input type="text" class="form-control form-control-sm" placeholder="Nhập từ khóa...">
            </div>
        </div>

        <div class="table-responsive-custom">
            <table id="table-detail-report" class="table table-bordered table-striped table-hover align-middle">
                <thead>
                    <tr>
                        <th class="text-nowrap">Thời gian</th>
                        <th class="text-nowrap">Merchant</th>
                        <th class="text-nowrap">Số TK Merchant</th>
                        <th class="text-nowrap highlight-new-col-header">Số TK Sub-Merchant</th>
                        <th class="text-nowrap">Mã GD</th>
                        <th class="text-nowrap">Mã đơn hàng VTC</th>
                        <th class="text-nowrap">VTCTransID</th>
                        <th class="text-nowrap">Mã đối tác</th>
                        <th class="text-nowrap">Tên KH</th>
                        <th class="text-nowrap">Số TK KH</th>
                        <th class="text-nowrap">PT Thanh toán</th>
                        <th class="text-end text-nowrap">Giá trị GD (1)</th>
                        <th class="text-end text-nowrap">Phí KH chịu (2)</th>
                        <th class="text-end text-nowrap">Phí Merchant chịu (3)</th>
                        <th class="text-end text-nowrap" title="(1)+(2)-(6)-(7)">Số tiền KH chịu (4)</th>
                        <th class="text-end text-nowrap" title="(1)-(3)">Số tiền Merchant nhận (5)</th>
                        <th class="text-end text-nowrap">Chiết khấu (6)</th>
                        <th class="text-end text-nowrap">Giảm giá (7)</th>
                        <th class="text-nowrap">Mã GD NH</th>
                        <th class="text-nowrap">Kênh kết nối</th>
                        <th class="text-center sticky-col-right" style="width: 80px;">Chức Năng</th>
                    </tr>
                </thead>
                <tbody id="tbody-detail-report"></tbody>
            </table>
        </div>
        
        <div class="d-flex justify-content-between align-items-center footer-pagination">
            <div class="text-muted fw-bold">Hiển thị 1-5 của 5 bản ghi chi tiết</div>
            <nav>
                <ul class="pagination pagination-sm">
                    <li class="page-item disabled"><a class="page-link" href="#"><i class="fa-solid fa-angle-left"></i></a></li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item disabled"><a class="page-link" href="#"><i class="fa-solid fa-angle-right"></i></a></li>
                </ul>
            </nav>
        </div>
    </div>

    <!-- ==============================================
         MODULE 4: BÁO CÁO HOÀN TIỀN TỔNG HỢP
         ============================================== -->
    <div id="section-refund-report" class="d-none-custom">
        <div class="page-title-bar shadow-sm">
            <i class="fa-solid fa-rotate-left me-2"></i> BÁO CÁO HOÀN TIỀN TỔNG HỢP
        </div>

        <div class="container-fluid filter-section">
            <div class="filter-toggle-container d-md-none">
                <button class="btn btn-filter-toggle" onclick="toggleFilter('filter-refund-report')">
                    <span><i class="fa-solid fa-filter me-2"></i> Bộ lọc hoàn tiền</span>
                    <i class="fa-solid fa-chevron-down icon-toggle"></i>
                </button>
            </div>

            <div id="filter-refund-report" class="filter-content-wrapper">
                <!-- Row 1 -->
                <div class="row align-items-center mb-2">
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-store"></i> Loại Mer</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option><option>Cá nhân</option><option>Doanh nghiệp</option></select></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-signature"></i> Tên Mer</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><input type="text" class="form-control" placeholder="Tên Merchant..."></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-regular fa-calendar-days"></i> Từ Ngày</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><div class="input-group"><input type="text" class="form-control" value="01/01/2026"><span class="input-group-text bg-white"><i class="fa-solid fa-calendar text-primary"></i></span></div></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-regular fa-calendar-days"></i> Đến Ngày</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><div class="input-group"><input type="text" class="form-control" value="31/01/2026"><span class="input-group-text bg-white"><i class="fa-solid fa-calendar text-primary"></i></span></div></div>
                </div>
                
                <!-- Row 2 -->
                <div class="row align-items-center mb-2">
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-user-tag"></i> TK Merchant</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><input type="text" class="form-control" placeholder="Tài khoản Merchant..."></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label highlight-new-label"><i class="fa-solid fa-store"></i> Sub-Mer</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><input type="text" class="form-control highlight-new-field" placeholder="TK Sub-Merchant..."></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-regular fa-id-card"></i> Mã Đối tác</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><input type="text" class="form-control" placeholder="Mã đối tác..."></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-money-bill-transfer"></i> Loại GD</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option><option>Hoàn toàn phần</option><option>Hoàn một phần</option></select></div>
                </div>

                <!-- Row 3 -->
                <div class="row align-items-center mb-2">
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-dungeon"></i> Cổng</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option><option>VTC Pay</option><option>ZaloPay</option></select></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-chart-pie"></i> Biểu đồ</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Không hiện</option><option>Biểu đồ cột</option></select></div>
                    
                    <div class="col-lg-6"></div>
                </div>
                
                <div class="text-center mt-3 mb-3 pb-2 border-bottom">
                     <button class="btn-search ripple"><i class="fa-solid fa-magnifying-glass me-1"></i> Tìm kiếm</button>
                </div>
            </div>
        </div>

        <div class="d-flex justify-content-between align-items-center action-toolbar rounded mx-3">
            <div class="toolbar-left d-flex flex-wrap">
                <button class="btn toolbar-btn"><i class="fa-solid fa-cloud-arrow-down text-primary"></i> Xuất dữ liệu</button>
                <button class="btn toolbar-btn"><i class="fa-solid fa-bars text-primary"></i> Hiện 10 dòng</button>
                <button class="btn toolbar-btn"><i class="fa-solid fa-eye-slash text-primary"></i> Ẩn/hiện cột</button>
            </div>
            <div class="toolbar-right d-flex align-items-center">
                <span class="me-2 fw-bold text-secondary" style="font-size: 12px; white-space: nowrap;">Tìm nhanh:</span>
                <input type="text" class="form-control form-control-sm" placeholder="Nhập từ khóa...">
            </div>
        </div>

        <div class="table-responsive-custom">
            <table id="table-refund-report" class="table table-bordered table-striped table-hover align-middle">
                <thead>
                    <tr>
                        <th class="text-center" style="width: 50px;">STT</th>
                        <th>Số TK Merchant</th>
                        <th class="highlight-new-col-header">Số TK Sub-Merchant</th>
                        <th>Loại GD</th>
                        <th class="text-end">Số lượng GD</th>
                        <th class="text-end">Tổng giá trị GD gốc</th>
                        <th class="text-end">Số tiền hoàn trả</th>
                        <th class="text-end">Phí Merchant chịu</th>
                        <th class="text-end">Phí hoàn merchant chịu</th>
                        <th class="text-end">Phí hoàn KH chịu</th>
                        <th class="text-end">Chiết khấu gốc</th>
                        <th class="text-end">Số tiền giảm giá</th>
                        <th class="text-end">Số tiền hoàn trả KH</th>
                    </tr>
                </thead>
                <tbody id="tbody-refund-report"></tbody>
                <tfoot class="fw-bold bg-light">
                    <tr>
                        <td colspan="4" class="text-end">TỔNG CỘNG:</td>
                        <td class="text-end text-primary" id="sum-rf-count">0</td>
                        <td class="text-end text-success" id="sum-rf-orig-val">0</td>
                        <td class="text-end text-danger" id="sum-rf-val">0</td>
                        <td class="text-end" id="sum-rf-fee-merch">0</td>
                        <td class="text-end" id="sum-rf-fee-refund-merch">0</td>
                        <td class="text-end" id="sum-rf-fee-cust">0</td>
                        <td class="text-end" id="sum-rf-disc">0</td>
                        <td class="text-end" id="sum-rf-promo">0</td>
                        <td class="text-end text-primary" id="sum-rf-cust-recv">0</td>
                    </tr>
                </tfoot>
            </table>
        </div>
        
        <div class="d-flex justify-content-between align-items-center footer-pagination">
            <div class="text-muted fw-bold">Hiển thị 1-5 của 5 bản ghi hoàn tiền</div>
            <nav>
                <ul class="pagination pagination-sm">
                    <li class="page-item disabled"><a class="page-link" href="#"><i class="fa-solid fa-angle-left"></i></a></li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item disabled"><a class="page-link" href="#"><i class="fa-solid fa-angle-right"></i></a></li>
                </ul>
            </nav>
        </div>
    </div>

    <!-- ==============================================
         MODULE 5: BÁO CÁO HOÀN TIỀN CHI TIẾT (NEW)
         ============================================== -->
    <div id="section-refund-detail-report" class="d-none-custom">
        <div class="page-title-bar shadow-sm">
            <i class="fa-solid fa-file-invoice-dollar me-2"></i> BÁO CÁO HOÀN TIỀN CHI TIẾT
        </div>

        <div class="container-fluid filter-section">
            <div class="filter-toggle-container d-md-none">
                <button class="btn btn-filter-toggle" onclick="toggleFilter('filter-refund-detail-report')">
                    <span><i class="fa-solid fa-filter me-2"></i> Bộ lọc chi tiết</span>
                    <i class="fa-solid fa-chevron-down icon-toggle"></i>
                </button>
            </div>

            <div id="filter-refund-detail-report" class="filter-content-wrapper">
                <!-- Row 1 -->
                <div class="row align-items-center mb-2">
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-store"></i> Loại Mer</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option><option>Cá nhân</option><option>Doanh nghiệp</option></select></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-signature"></i> Tên Mer</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><input type="text" class="form-control" placeholder="Tên Merchant..."></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-user-tag"></i> TK Merchant</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><input type="text" class="form-control" placeholder="Tài khoản Merchant..."></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label highlight-new-label"><i class="fa-solid fa-store"></i> Sub-Mer</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><input type="text" class="form-control highlight-new-field" placeholder="TK Sub-Merchant..."></div>
                </div>
                
                <!-- Row 2 -->
                <div class="row align-items-center mb-2">
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-regular fa-id-card"></i> Đối tác</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><input type="text" class="form-control" placeholder="Mã đối tác..."></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-money-bill-transfer"></i> Loại GD</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option><option>Hoàn toàn phần</option><option>Hoàn một phần</option></select></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-money-check-dollar"></i> Phương thức</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option><option>Ví điện tử</option><option>Thẻ quốc tế</option><option>Thẻ nội địa</option></select></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-database"></i> Kiểu DL</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Mặc định</option></select></div>
                </div>

                <!-- Row 3 -->
                <div class="row align-items-center mb-2">
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-network-wired"></i> Kênh KN</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option></select></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-regular fa-calendar-days"></i> Từ Ngày</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><div class="input-group"><input type="text" class="form-control" value="01/01/2026"><span class="input-group-text bg-white"><i class="fa-solid fa-calendar text-primary"></i></span></div></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-regular fa-calendar-days"></i> Đến Ngày</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><div class="input-group"><input type="text" class="form-control" value="31/01/2026"><span class="input-group-text bg-white"><i class="fa-solid fa-calendar text-primary"></i></span></div></div>
                    
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-chart-pie"></i> Biểu đồ</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Không hiện</option><option>Biểu đồ cột</option></select></div>
                </div>

                <!-- Row 4 -->
                <div class="row align-items-center mb-2">
                    <div class="col-lg-1 col-md-12 mb-1"><label class="filter-label"><i class="fa-solid fa-money-bill-wave"></i> Hình thức rút</label></div>
                    <div class="col-lg-2 col-md-6 mb-2"><select class="form-select"><option>Tất cả</option></select></div>
                    
                    <div class="col-lg-9"></div>
                </div>
                
                <div class="text-center mt-3 mb-3 pb-2 border-bottom">
                     <button class="btn-search ripple"><i class="fa-solid fa-magnifying-glass me-1"></i> Tìm kiếm</button>
                </div>
            </div>
        </div>

        <div class="d-flex justify-content-between align-items-center action-toolbar rounded mx-3">
            <div class="toolbar-left d-flex flex-wrap">
                <button class="btn toolbar-btn"><i class="fa-solid fa-cloud-arrow-down text-primary"></i> Xuất dữ liệu</button>
                <button class="btn toolbar-btn"><i class="fa-solid fa-bars text-primary"></i> Hiện 10 dòng</button>
                <button class="btn toolbar-btn"><i class="fa-solid fa-eye-slash text-primary"></i> Ẩn/hiện cột</button>
            </div>
            <div class="toolbar-right d-flex align-items-center">
                <span class="me-2 fw-bold text-secondary" style="font-size: 12px; white-space: nowrap;">Tìm nhanh:</span>
                <input type="text" class="form-control form-control-sm" placeholder="Nhập từ khóa...">
            </div>
        </div>

        <div class="table-responsive-custom">
            <table id="table-refund-detail-report" class="table table-bordered table-striped table-hover align-middle">
                <thead>
                    <tr>
                        <th class="text-nowrap">Thời gian</th>
                        <th class="text-nowrap">Thời gian GD</th>
                        <th class="text-nowrap">Merchant</th>
                        <th class="text-nowrap">Số TK Merchant</th>
                        <!-- Added Column -->
                        <th class="text-nowrap highlight-new-col-header">Số TK Sub-Merchant</th>
                        <th class="text-nowrap">Số TK KH</th>
                        <th class="text-nowrap">Đối tác</th>
                        <th class="text-nowrap">Mã ngân hàng</th>
                        <th class="text-nowrap">Mã GD</th>
                        <th class="text-nowrap">Mã Đơn hàng</th>
                        <th class="text-end text-nowrap">Tổng giá trị GD Gốc</th>
                        <th class="text-end text-nowrap">Số tiền hoàn trả (1)</th>
                        <th class="text-end text-nowrap">Phí Merchant chịu (2)</th>
                        <th class="text-end text-nowrap">Phí KH chịu (3)</th>
                        <th class="text-end text-nowrap">Phí hoàn merchant chịu (4)</th>
                        <th class="text-end text-nowrap">Phí hoàn KH chịu (5)</th>
                        <th class="text-end text-nowrap">Chiết khấu gốc (6)</th>
                        <th class="text-end text-nowrap">Giảm giá (7)</th>
                        <th class="text-end text-nowrap" title="(1)-(5)-(7)">Số tiền hoàn trả KH (8)</th>
                        <th class="text-nowrap">Loại giao dịch</th>
                        <th class="text-nowrap">Cổng kết nối</th>
                        <th class="text-center sticky-col-right" style="width: 80px;">Chức Năng</th>
                    </tr>
                </thead>
                <tbody id="tbody-refund-detail-report"></tbody>
            </table>
        </div>
        
        <div class="d-flex justify-content-between align-items-center footer-pagination">
            <div class="text-muted fw-bold">Hiển thị 1-5 của 5 bản ghi chi tiết</div>
            <nav>
                <ul class="pagination pagination-sm">
                    <li class="page-item disabled"><a class="page-link" href="#"><i class="fa-solid fa-angle-left"></i></a></li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item disabled"><a class="page-link" href="#"><i class="fa-solid fa-angle-right"></i></a></li>
                </ul>
            </nav>
        </div>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // --- LOGIC CHUYỂN TAB ---
        function switchTab(tabName) {
            // Update Nav Styles
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active-tab'));
            
            // Handle Dropdown Active State
            if (['report', 'detail-report', 'refund-report', 'refund-detail-report'].includes(tabName)) {
                const dropdownBtn = document.getElementById('reportDropdown');
                dropdownBtn.classList.add('active-tab');
                
                // Highlight dropdown item
                document.querySelectorAll('.dropdown-item').forEach(item => item.classList.remove('active'));
                document.getElementById('nav-' + tabName).classList.add('active');
            } else {
                document.getElementById('nav-' + tabName).classList.add('active-tab');
            }

            // Show/Hide Sections
            document.querySelectorAll('[id^="section-"]').forEach(el => el.classList.add('d-none-custom'));
            
            document.getElementById('section-' + tabName).classList.remove('d-none-custom');
            
            // Re-init resizers for visible table
            setTimeout(initColumnResize, 100);
        }

        // --- LOGIC FILTER MOBILE ---
        function toggleFilter(id) {
            const content = document.getElementById(id);
            const parent = content.parentElement;
            const icon = parent.querySelector('.icon-toggle');
            
            content.classList.toggle('show');
            
            if(content.classList.contains('show')) {
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-up');
            } else {
                icon.classList.remove('fa-chevron-up');
                icon.classList.add('fa-chevron-down');
            }
        }

        function formatCurrency(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // --- DATA MODULE 1: DUYỆT TIỀN CÔNG ---
        const approvalData = [
             { time: "14/01/2026 14:54:37", partner: "20260114145431", order: "1100013338", vtcId: "POR3bd28af1ea02f", transCode: "PG-1000001104", type: "Thanh toán qua Deeplink App", bank: "DeepLinkApp", merchant: "NOVATECH", subMerchant: "0981234567", name: "Nguyễn Văn A", bankAcc: "", amount: "10,000", bankTrans: "797909", executor: "hangnm", successTime: "14/01/2026 14:57:19", merchType: "", gateway: "ZaloPay", status: "Thành công", actionType: "view" },
             { time: "14/01/2026 16:44:21", partner: "20260114164155", order: "1100013339", vtcId: "POR3bd28af1ea02f", transCode: "PG-1000001105", type: "Thanh toán chuyển khoản", bank: "NCB", merchant: "GLOBALPAY", subMerchant: "", name: "Trần Thị B", bankAcc: "1100013339", amount: "10,000", bankTrans: "1100013339", executor: "System", successTime: "14/01/2026 17:30:11", merchType: "", gateway: "NCB", status: "Hủy", actionType: "none" },
             { time: "14/01/2026 17:11:19", partner: "20260114171111", order: "1100013340", vtcId: "POR3bd28af1ea02g", transCode: "PG-1000001106", type: "Thanh toán qua Deeplink App", bank: "DeepLinkApp", merchant: "TIKICORP", subMerchant: "BOOKSTORE", name: "Lê Văn C", bankAcc: "", amount: "20,000", bankTrans: "7979091", executor: "hangnm", successTime: "14/01/2026 17:12:47", merchType: "", gateway: "ZaloPay", status: "Thành công", actionType: "view" },
             { time: "14/01/2026 17:26:56", partner: "20260114172651", order: "1100013342", vtcId: "POR3bd28af1ea02h", transCode: "PG-1000001107", type: "Thanh toán qua Deeplink App", bank: "DeepLinkApp", merchant: "SHOPEEMALL", subMerchant: "SAMSUNGOFFICIAL", name: "", bankAcc: "", amount: "15,000", bankTrans: "", executor: "", successTime: "---", merchType: "", gateway: "ZaloPay", status: "Khởi tạo", actionType: "approve" },
             { time: "14/01/2026 17:27:16", partner: "20260114172711", order: "1100013343", vtcId: "POR3bd28af1ea02i", transCode: "PG-1000001108", type: "Thanh toán qua Deeplink App", bank: "DeepLinkApp", merchant: "LAZADAVN", subMerchant: "LOCKANDLOCK", name: "", bankAcc: "", amount: "30,000", bankTrans: "", executor: "", successTime: "---", merchType: "", gateway: "ZaloPay", status: "Khởi tạo", actionType: "approve" },
             { time: "14/01/2026 17:29:23", partner: "20260114172625", order: "1100013344", vtcId: "POR3bd28af1ea02j", transCode: "PG-1000001109", type: "Thanh toán qua Deeplink App", bank: "DeepLinkApp", merchant: "CGVCINEMA", subMerchant: "0912999888", name: "", bankAcc: "", amount: "10,000", bankTrans: "", executor: "", successTime: "---", merchType: "", gateway: "ZaloPay", status: "Khởi tạo", actionType: "approve" },
             { time: "14/01/2026 17:29:49", partner: "20260114172910", order: "1100013345", vtcId: "POR3bd28af1ea02k", transCode: "PG-1000001110", type: "Thanh toán qua Deeplink App", bank: "DeepLinkApp", merchant: "TRAVELOKA", subMerchant: "VNAIRLINES", name: "Phạm Văn D", bankAcc: "", amount: "50,000", bankTrans: "", executor: "System", successTime: "14/01/2026 17:40:06", merchType: "", gateway: "ZaloPay", status: "Hủy", actionType: "none" },
             { time: "14/01/2026 17:33:06", partner: "20260114173256", order: "1100013346", vtcId: "POR76e672d8d6014", transCode: "PG-1000001111", type: "Thanh toán chuyển khoản", bank: "NCB", merchant: "GRABFOOD", subMerchant: "KFCVIETNAM", name: "", bankAcc: "1100013346", amount: "100,000", bankTrans: "1100013346", executor: "", successTime: "---", merchType: "", gateway: "NCB", status: "Khởi tạo", actionType: "approve" },
             { time: "14/01/2026 17:38:54", partner: "20260114173849", order: "1100013347", vtcId: "POR3bd28af1ea02l", transCode: "PG-1000001112", type: "Thanh toán qua Deeplink App", bank: "DeepLinkApp", merchant: "BEGROUP", subMerchant: "0909123456", name: "Hoàng Thị E", bankAcc: "", amount: "10,000", bankTrans: "797909133", executor: "hangnm", successTime: "14/01/2026 17:48:30", merchType: "", gateway: "ZaloPay", status: "Đã hoàn tiền", actionType: "none" },
             { time: "14/01/2026 17:41:03", partner: "20260114174056", order: "1100013348", vtcId: "PORccc938006ef18", transCode: "PG-1000001113", type: "Thanh toán chuyển khoản", bank: "NCB", merchant: "0988777666", subMerchant: "TOPUP", name: "", bankAcc: "1100013348", amount: "25,000", bankTrans: "1100013348", executor: "hangnm", successTime: "14/01/2026 17:41:53", merchType: "", gateway: "NCB", status: "Thành công", actionType: "view" }
        ];

        // --- DATA MODULE 2: BÁO CÁO TỔNG HỢP ---
        const reportData = [
            { id: 1, name: "Chuỗi Mẹ và Bé", merch: "MOMANDBABY", subMerch: "0981234567", count: 120, val: 1200000000, feeCust: 0, feeMerch: 12000000, disc: 5000000, promo: 2000000 },
            { id: 2, name: "Tạp hóa Minh Anh", merch: "MINHANHMART", subMerch: "0912345678", count: 50, val: 500000000, feeCust: 2000000, feeMerch: 5000000, disc: 0, promo: 0 },
            { id: 3, name: "Siêu thị Điện máy", merch: "DIENMAYXANH", subMerch: "DMXHANOI", count: 800, val: 3000000000, feeCust: 5000000, feeMerch: 30000000, disc: 15000000, promo: 10000000 },
            { id: 4, name: "Thời trang Nữ", merch: "EVADEEVA", subMerch: "EVAROYAL", count: 200, val: 400000000, feeCust: 0, feeMerch: 4000000, disc: 2000000, promo: 1000000 },
            { id: 5, name: "Nhà sách Phương Nam", merch: "PHUONGNAM", subMerch: "PNSAIGON", count: 80, val: 140000000, feeCust: 500000, feeMerch: 1400000, disc: 0, promo: 0 },
        ];

        // --- DATA MODULE 3: BÁO CÁO CHI TIẾT ---
        const detailReportData = [
            { time: "21/01/2026 10:15:23", merch: "Công Ty CP Dịch Vụ Di Động", merchAcc: "VTCMOBILE", subMerchAcc: "GAMEAUDITION", transId: "26012110152301", orderId: "ORD-2026-001", vtcTrans: "VTC-88273645", partner: "PART001", cust: "Nguyễn Thị Mai", custAcc: "0912***789", method: "Thẻ nội địa", val: 500000, feeCust: 5500, feeMerch: 0, disc: 0, promo: 0, bankTransId: "VCB.12345678", channel: "Website" },
            { time: "21/01/2026 10:20:45", merch: "Shop Thời Trang Eva", merchAcc: "EVAFASHION", subMerchAcc: "EVAONLINE", transId: "26012110204502", orderId: "ORD-2026-002", vtcTrans: "VTC-88273646", partner: "PART002", cust: "Trần Văn Hùng", custAcc: "0903***456", method: "Ví điện tử", val: 250000, feeCust: 0, feeMerch: 2500, disc: 10000, promo: 5000, bankTransId: "VTC.88273646", channel: "App" },
            { time: "21/01/2026 10:45:10", merch: "Nhà Sách Trí Tuệ", merchAcc: "TRITUEBOOKS", subMerchAcc: "TTCAUGIAY", transId: "26012110451003", orderId: "ORD-2026-003", vtcTrans: "VTC-88273647", partner: "PART003", cust: "Lê Thu Hà", custAcc: "0987***123", method: "QR Code", val: 120000, feeCust: 0, feeMerch: 1200, disc: 0, promo: 0, bankTransId: "MB.98765432", channel: "POS" },
            { time: "21/01/2026 11:05:30", merch: "Siêu Thị Điện Máy Xanh", merchAcc: "DMXCORP", subMerchAcc: "DMXWEB", transId: "26012111053004", orderId: "ORD-2026-004", vtcTrans: "VTC-88273648", partner: "PART004", cust: "Phạm Minh Tuấn", custAcc: "0933***555", method: "Thẻ quốc tế", val: 5500000, feeCust: 0, feeMerch: 110000, disc: 0, promo: 200000, bankTransId: "VISA.11223344", channel: "Website" },
            { time: "21/01/2026 11:30:00", merch: "Cửa Hàng Tiện Lợi 24h", merchAcc: "CIRCLEK", subMerchAcc: "0911222333", transId: "26012111300005", orderId: "ORD-2026-005", vtcTrans: "VTC-88273649", partner: "PART005", cust: "Vũ Thị Lan", custAcc: "0944***222", method: "Ví điện tử", val: 45000, feeCust: 0, feeMerch: 450, disc: 0, promo: 0, bankTransId: "VTC.88273649", channel: "App" },
            { time: "21/01/2026 12:15:15", merch: "Công Ty Du Lịch Việt", merchAcc: "VIETRAVEL", subMerchAcc: "TOURINBOUND", transId: "26012112151506", orderId: "ORD-2026-006", vtcTrans: "VTC-88273650", partner: "PART006", cust: "Hoàng Văn Nam", custAcc: "0911***333", method: "Thẻ nội địa", val: 3200000, feeCust: 11000, feeMerch: 0, disc: 0, promo: 0, bankTransId: "TCB.55667788", channel: "Website" },
            { time: "21/01/2026 13:00:00", merch: "Shop Mỹ Phẩm Hana", merchAcc: "HANACOSMETIC", subMerchAcc: "HANASHOPEE", transId: "26012113000007", orderId: "ORD-2026-007", vtcTrans: "VTC-88273651", partner: "PART007", cust: "Đặng Thị Thảo", custAcc: "0977***888", method: "QR Code", val: 890000, feeCust: 0, feeMerch: 8900, disc: 50000, promo: 0, bankTransId: "CTG.99887766", channel: "App" },
            { time: "21/01/2026 13:45:50", merch: "Nhà Hàng Biển Đông", merchAcc: "BIENDONG", subMerchAcc: "0909123123", transId: "26012113455008", orderId: "ORD-2026-008", vtcTrans: "VTC-88273652", partner: "PART008", cust: "Bùi Văn Long", custAcc: "0988***999", method: "Thẻ quốc tế", val: 2150000, feeCust: 0, feeMerch: 43000, disc: 0, promo: 0, bankTransId: "MC.44332211", channel: "POS" },
            { time: "21/01/2026 14:10:20", merch: "Game Center ABC", merchAcc: "ABCGAMING", subMerchAcc: "0912345678", transId: "26012114102009", orderId: "ORD-2026-009", vtcTrans: "VTC-88273653", partner: "PART009", cust: "Ngô Minh Đức", custAcc: "0905***777", method: "Ví điện tử", val: 100000, feeCust: 0, feeMerch: 1000, disc: 0, promo: 0, bankTransId: "VTC.88273653", channel: "Website" },
            { time: "21/01/2026 14:55:05", merch: "Tạp Hóa Cô Bảy", merchAcc: "COBAYSTORE", subMerchAcc: "0987654321", transId: "26012114550510", orderId: "ORD-2026-010", vtcTrans: "VTC-88273654", partner: "PART010", cust: "Đỗ Thị Hồng", custAcc: "0934***111", method: "QR Code", val: 65000, feeCust: 0, feeMerch: 650, disc: 0, promo: 0, bankTransId: "BIDV.66554433", channel: "App" }
        ];

        // --- DATA MODULE 4: BÁO CÁO HOÀN TIỀN (UPDATED DATA) ---
        const refundReportData = [
            { id: 1, merchAcc: "NOVATECH", subMerchAcc: "0911222333", transType: "Hoàn toàn phần", count: 12, origVal: 12000000, refundVal: 12000000, feeMerch: 120000, refundFeeMerch: 0, feeRefundCust: 0, disc: 0, promo: 0, custRecv: 12000000 },
            { id: 2, merchAcc: "MINHANHMART", subMerchAcc: "0988777666", transType: "Hoàn một phần", count: 5, origVal: 5000000, refundVal: 2500000, feeMerch: 50000, refundFeeMerch: 25000, feeRefundCust: 0, disc: 0, promo: 0, custRecv: 2500000 },
            { id: 3, merchAcc: "DIENMAYXANH", subMerchAcc: "DMXHANOI", transType: "Hoàn toàn phần", count: 8, origVal: 8500000, refundVal: 8500000, feeMerch: 85000, refundFeeMerch: 0, feeRefundCust: 50000, disc: 0, promo: 200000, custRecv: 8250000 },
            { id: 4, merchAcc: "EVADEEVA", subMerchAcc: "EVAROYAL", transType: "Hoàn một phần", count: 3, origVal: 3000000, refundVal: 1000000, feeMerch: 30000, refundFeeMerch: 10000, feeRefundCust: 0, disc: 50000, promo: 0, custRecv: 1000000 },
            { id: 5, merchAcc: "PHUONGNAM", subMerchAcc: "PNSAIGON", transType: "Hoàn toàn phần", count: 2, origVal: 1500000, refundVal: 1500000, feeMerch: 15000, refundFeeMerch: 0, feeRefundCust: 0, disc: 0, promo: 0, custRecv: 1500000 },
            { id: 6, merchAcc: "VTCMOBILE", subMerchAcc: "GAMEAUDITION", transType: "Hoàn toàn phần", count: 15, origVal: 35000000, refundVal: 35000000, feeMerch: 350000, refundFeeMerch: 0, feeRefundCust: 0, disc: 1000000, promo: 500000, custRecv: 33500000 },
            { id: 7, merchAcc: "VIETRAVEL", subMerchAcc: "TOURINBOUND", transType: "Hoàn một phần", count: 1, origVal: 2000000, refundVal: 500000, feeMerch: 20000, refundFeeMerch: 5000, feeRefundCust: 2000, disc: 0, promo: 0, custRecv: 498000 },
            { id: 8, merchAcc: "HANACOSMETIC", subMerchAcc: "HANASHOPEE", transType: "Hoàn toàn phần", count: 4, origVal: 1800000, refundVal: 1800000, feeMerch: 18000, refundFeeMerch: 0, feeRefundCust: 0, disc: 0, promo: 0, custRecv: 1800000 },
            { id: 9, merchAcc: "ABCGAMING", subMerchAcc: "0912345678", transType: "Hoàn toàn phần", count: 6, origVal: 6000000, refundVal: 6000000, feeMerch: 60000, refundFeeMerch: 0, feeRefundCust: 0, disc: 0, promo: 100000, custRecv: 5900000 },
            { id: 10, merchAcc: "COBAYSTORE", subMerchAcc: "0987654321", transType: "Hoàn một phần", count: 9, origVal: 12500000, refundVal: 4500000, feeMerch: 125000, refundFeeMerch: 45000, feeRefundCust: 0, disc: 200000, promo: 0, custRecv: 4500000 }
        ];

        // --- DATA MODULE 5: BÁO CÁO HOÀN TIỀN CHI TIẾT (NEW) ---
        const refundDetailData = [
            { time: "22/01/2026 09:30:00", transTime: "21/01/2026 10:15:23", merch: "Công Ty CP Dịch Vụ Di Động", merchAcc: "VTCMOBILE", subMerchAcc: "GAMEAUDITION", custAcc: "0912***789", partner: "PART001", bank: "Vietcombank", transId: "REF-001", orderId: "ORD-2026-001", totalVal: 500000, refundVal: 500000, feeMerch: 5000, feeCust: 5500, refundFeeMerch: 0, refundFeeCust: 0, disc: 0, promo: 0, type: "Hoàn toàn phần", gateway: "VTC Pay" },
            { time: "22/01/2026 10:00:00", transTime: "21/01/2026 10:20:45", merch: "Shop Thời Trang Eva", merchAcc: "EVAFASHION", subMerchAcc: "EVAONLINE", custAcc: "0903***456", partner: "PART002", bank: "Techcombank", transId: "REF-002", orderId: "ORD-2026-002", totalVal: 250000, refundVal: 100000, feeMerch: 2500, feeCust: 0, refundFeeMerch: 1000, refundFeeCust: 0, disc: 10000, promo: 5000, type: "Hoàn một phần", gateway: "ZaloPay" },
            { time: "22/01/2026 11:15:00", transTime: "21/01/2026 10:45:10", merch: "Nhà Sách Trí Tuệ", merchAcc: "TRITUEBOOKS", subMerchAcc: "TTCAUGIAY", custAcc: "0987***123", partner: "PART003", bank: "MB Bank", transId: "REF-003", orderId: "ORD-2026-003", totalVal: 120000, refundVal: 120000, feeMerch: 1200, feeCust: 0, refundFeeMerch: 0, refundFeeCust: 0, disc: 0, promo: 0, type: "Hoàn toàn phần", gateway: "Momo" },
            { time: "22/01/2026 13:45:00", transTime: "21/01/2026 11:05:30", merch: "Siêu Thị Điện Máy Xanh", merchAcc: "DMXCORP", subMerchAcc: "DMXWEB", custAcc: "0933***555", partner: "PART004", bank: "Vietinbank", transId: "REF-004", orderId: "ORD-2026-004", totalVal: 5500000, refundVal: 5500000, feeMerch: 110000, feeCust: 0, refundFeeMerch: 0, refundFeeCust: 0, disc: 0, promo: 200000, type: "Hoàn toàn phần", gateway: "VTC Pay" },
            { time: "22/01/2026 15:20:00", transTime: "21/01/2026 11:30:00", merch: "Cửa Hàng Tiện Lợi 24h", merchAcc: "CIRCLEK", subMerchAcc: "0911222333", custAcc: "0944***222", partner: "PART005", bank: "BIDV", transId: "REF-005", orderId: "ORD-2026-005", totalVal: 45000, refundVal: 45000, feeMerch: 450, feeCust: 0, refundFeeMerch: 0, refundFeeCust: 0, disc: 0, promo: 0, type: "Hoàn toàn phần", gateway: "ZaloPay" }
        ];

        // --- RENDER FUNCTIONS ---
        function renderApproval() {
            const tbody = document.getElementById('tbody-approval');
            let html = '';
            approvalData.forEach(row => {
                let statusClass = '';
                if(row.status === 'Thành công') statusClass = 'status-success';
                else if(row.status === 'Hủy') statusClass = 'status-cancel';
                else if(row.status === 'Khởi tạo') statusClass = 'status-init';
                else if(row.status === 'Đã hoàn tiền') statusClass = 'status-refund';

                let actionHtml = '';
                if(row.actionType === 'view') {
                    actionHtml = `<div class="action-btn-group"><button class="btn-view" title="Xem chi tiết"><i class="fa-regular fa-eye"></i></button></div>`;
                } else if(row.actionType === 'approve') {
                    actionHtml = `
                        <div class="action-btn-group">
                            <button class="btn-check" title="Duyệt"><i class="fa-solid fa-check"></i></button>
                            <button class="btn-cancel" title="Hủy"><i class="fa-solid fa-xmark"></i></button>
                        </div>
                    `;
                }

                html += `
                    <tr>
                        <td class="text-nowrap">${row.time}</td>
                        <td>${row.partner}</td>
                        <td class="fw-bold text-primary">${row.order}</td>
                        <td style="max-width: 100px; overflow: hidden; text-overflow: ellipsis;" title="${row.vtcId}">${row.vtcId}</td>
                        <td>${row.transCode.replace('PG-', 'PG-<br>')}</td>
                        <td>${row.type}</td>
                        <td>${row.bank}</td>
                        <td>${row.merchant}</td>
                        <td class="highlight-new-col-cell">${row.subMerchant}</td>
                        <td>${row.name}</td>
                        <td>${row.bankAcc}</td>
                        <td class="text-end fw-bold">${row.amount}</td>
                        <td>${row.bankTrans}</td>
                        <td>${row.executor}</td>
                        <td class="text-nowrap">${row.successTime}</td>
                        <td>${row.merchType}</td>
                        <td>${row.gateway}</td>
                        <td class="${statusClass}">${row.status}</td>
                        <td class="text-center sticky-col-right">${actionHtml}</td>
                    </tr>
                `;
            });
            tbody.innerHTML = html;
        }

        function renderReport() {
            const tbody = document.getElementById('tbody-report');
            let html = '';
            let sCount=0, sVal=0, sFeeCust=0, sFeeMerch=0, sCustPay=0, sMerchRecv=0, sDisc=0, sPromo=0;
            reportData.forEach(row => {
                const custPay = row.val + row.feeCust - row.disc - row.promo;
                const merchRecv = row.val - row.feeMerch;
                sCount += row.count; sVal += row.val; sFeeCust += row.feeCust; sFeeMerch += row.feeMerch; sCustPay += custPay; sMerchRecv += merchRecv; sDisc += row.disc; sPromo += row.promo;
                html += `<tr><td class="text-center">${row.id}</td><td>${row.name}</td><td>${row.merch}</td><td class="highlight-new-col-cell">${row.subMerch}</td><td class="text-end">${row.count}</td><td class="text-end fw-bold">${formatCurrency(row.val)}</td><td class="text-end">${formatCurrency(row.feeCust)}</td><td class="text-end">${formatCurrency(row.feeMerch)}</td><td class="text-end fw-bold text-primary">${formatCurrency(custPay)}</td><td class="text-end fw-bold text-success">${formatCurrency(merchRecv)}</td><td class="text-end text-muted">${formatCurrency(row.disc)}</td><td class="text-end text-muted">${formatCurrency(row.promo)}</td><td class="text-center sticky-col-right"><div class="action-btn-group"><button class="btn-view" title="Xem chi tiết"><i class="fa-regular fa-eye"></i></button></div></td></tr>`;
            });
            tbody.innerHTML = html;
            document.getElementById('sum-count').innerText = formatCurrency(sCount);
            document.getElementById('sum-val').innerText = formatCurrency(sVal);
            document.getElementById('sum-fee-cust').innerText = formatCurrency(sFeeCust);
            document.getElementById('sum-fee-merch').innerText = formatCurrency(sFeeMerch);
            document.getElementById('sum-cust-pay').innerText = formatCurrency(sCustPay);
            document.getElementById('sum-merch-recv').innerText = formatCurrency(sMerchRecv);
            document.getElementById('sum-discount').innerText = formatCurrency(sDisc);
            document.getElementById('sum-promo').innerText = formatCurrency(sPromo);
        }

        function renderDetailReport() {
            const tbody = document.getElementById('tbody-detail-report');
            let html = '';
            detailReportData.forEach(row => {
                const custPay = row.val + row.feeCust - row.disc - row.promo;
                const merchRecv = row.val - row.feeMerch;
                html += `<tr><td class="text-nowrap">${row.time}</td><td class="text-nowrap">${row.merch}</td><td>${row.merchAcc}</td><td class="highlight-new-col-cell">${row.subMerchAcc}</td><td>${row.transId}</td><td>${row.orderId}</td><td>${row.vtcTrans}</td><td>${row.partner}</td><td class="text-nowrap">${row.cust}</td><td>${row.custAcc}</td><td>${row.method}</td><td class="text-end fw-bold">${formatCurrency(row.val)}</td><td class="text-end">${formatCurrency(row.feeCust)}</td><td class="text-end">${formatCurrency(row.feeMerch)}</td><td class="text-end fw-bold text-primary">${formatCurrency(custPay)}</td><td class="text-end fw-bold text-success">${formatCurrency(merchRecv)}</td><td class="text-end text-muted">${formatCurrency(row.disc)}</td><td class="text-end text-muted">${formatCurrency(row.promo)}</td><td>${row.bankTransId}</td><td>${row.channel}</td><td class="text-center sticky-col-right"><div class="action-btn-group"><button class="btn-view" title="Xem chi tiết"><i class="fa-regular fa-eye"></i></button></div></td></tr>`;
            });
            tbody.innerHTML = html;
        }

        function renderRefundReport() {
            const tbody = document.getElementById('tbody-refund-report');
            let html = '';
            let sCount = 0, sOrigVal = 0, sRefundVal = 0, sFeeMerch = 0, sRefundFeeMerch = 0, sFeeRefundCust = 0, sDisc = 0, sPromo = 0, sCustRecv = 0;
            refundReportData.forEach(row => {
                sCount += row.count; sOrigVal += row.origVal; sRefundVal += row.refundVal; sFeeMerch += row.feeMerch; sRefundFeeMerch += row.refundFeeMerch; sFeeRefundCust += row.feeRefundCust; sDisc += row.disc; sPromo += row.promo; sCustRecv += row.custRecv;
                html += `<tr><td class="text-center">${row.id}</td><td>${row.merchAcc}</td><td class="highlight-new-col-cell">${row.subMerchAcc}</td><td>${row.transType}</td><td class="text-end">${row.count}</td><td class="text-end text-success">${formatCurrency(row.origVal)}</td><td class="text-end fw-bold text-danger">${formatCurrency(row.refundVal)}</td><td class="text-end">${formatCurrency(row.feeMerch)}</td><td class="text-end">${formatCurrency(row.refundFeeMerch)}</td><td class="text-end">${formatCurrency(row.feeRefundCust)}</td><td class="text-end text-muted">${formatCurrency(row.disc)}</td><td class="text-end text-muted">${formatCurrency(row.promo)}</td><td class="text-end fw-bold text-primary">${formatCurrency(row.custRecv)}</td></tr>`;
            });
            tbody.innerHTML = html;
            document.getElementById('sum-rf-count').innerText = formatCurrency(sCount);
            document.getElementById('sum-rf-orig-val').innerText = formatCurrency(sOrigVal);
            document.getElementById('sum-rf-val').innerText = formatCurrency(sRefundVal);
            document.getElementById('sum-rf-fee-merch').innerText = formatCurrency(sFeeMerch);
            document.getElementById('sum-rf-fee-refund-merch').innerText = formatCurrency(sRefundFeeMerch);
            document.getElementById('sum-rf-fee-cust').innerText = formatCurrency(sFeeRefundCust);
            document.getElementById('sum-rf-disc').innerText = formatCurrency(sDisc);
            document.getElementById('sum-rf-promo').innerText = formatCurrency(sPromo);
            document.getElementById('sum-rf-cust-recv').innerText = formatCurrency(sCustRecv);
        }

        function renderRefundDetailReport() {
            const tbody = document.getElementById('tbody-refund-detail-report');
            let html = '';
            refundDetailData.forEach(row => {
                // (8) = (1) - (5) - (7)
                // (1): refundVal
                // (5): refundFeeCust
                // (7): promo
                const custRecv = row.refundVal - row.refundFeeCust - row.promo;

                html += `
                    <tr>
                        <td class="text-nowrap">${row.time}</td>
                        <td class="text-nowrap">${row.transTime}</td>
                        <td class="text-nowrap">${row.merch}</td>
                        <td>${row.merchAcc}</td>
                        <!-- Added Cell -->
                        <td class="highlight-new-col-cell">${row.subMerchAcc}</td>
                        <td>${row.custAcc}</td>
                        <td>${row.partner}</td>
                        <td>${row.bank}</td>
                        <td>${row.transId}</td>
                        <td>${row.orderId}</td>
                        <td class="text-end">${formatCurrency(row.totalVal)}</td>
                        <td class="text-end fw-bold text-danger">${formatCurrency(row.refundVal)}</td>
                        <td class="text-end">${formatCurrency(row.feeMerch)}</td>
                        <td class="text-end">${formatCurrency(row.feeCust)}</td>
                        <td class="text-end">${formatCurrency(row.refundFeeMerch)}</td>
                        <td class="text-end">${formatCurrency(row.refundFeeCust)}</td>
                        <td class="text-end text-muted">${formatCurrency(row.disc)}</td>
                        <td class="text-end text-muted">${formatCurrency(row.promo)}</td>
                        <td class="text-end fw-bold text-primary">${formatCurrency(custRecv)}</td>
                        <td>${row.type}</td>
                        <td>${row.gateway}</td>
                        <td class="text-center sticky-col-right">
                             <div class="action-btn-group"><button class="btn-view" title="Xem chi tiết"><i class="fa-regular fa-eye"></i></button></div>
                        </td>
                    </tr>
                `;
            });
            tbody.innerHTML = html;
        }

        function initColumnResize() {
            // Find active table container
            let activeTableId = '';
            if (!document.getElementById('section-approval').classList.contains('d-none-custom')) {
                activeTableId = 'table-approval';
            } else if (!document.getElementById('section-report').classList.contains('d-none-custom')) {
                activeTableId = 'table-report';
            } else if (!document.getElementById('section-detail-report').classList.contains('d-none-custom')) {
                activeTableId = 'table-detail-report';
            } else if (!document.getElementById('section-refund-report').classList.contains('d-none-custom')) {
                activeTableId = 'table-refund-report';
            } else if (!document.getElementById('section-refund-detail-report').classList.contains('d-none-custom')) {
                activeTableId = 'table-refund-detail-report';
            }

            if(!activeTableId) return;
            const activeTable = document.getElementById(activeTableId);

            const headers = activeTable.querySelectorAll('th');
            
            headers.forEach(th => {
                if(th.querySelector('.resizer')) th.querySelector('.resizer').remove();
            });

            headers.forEach((th, index) => {
                if (th.classList.contains('sticky-col-right')) return; 

                const resizer = document.createElement('div');
                resizer.classList.add('resizer');
                th.appendChild(resizer);
                
                let x = 0;
                let w = 0;

                const mouseDownHandler = function(e) {
                    x = e.clientX;
                    const styles = window.getComputedStyle(th);
                    w = parseInt(styles.width, 10);
                    document.addEventListener('mousemove', mouseMoveHandler);
                    document.addEventListener('mouseup', mouseUpHandler);
                    resizer.classList.add('resizing');
                };

                const mouseMoveHandler = function(e) {
                    const dx = e.clientX - x;
                    const newWidth = w + dx;
                     if (newWidth > 30) {
                        th.style.width = `${newWidth}px`;
                        th.style.minWidth = `${newWidth}px`;
                    }
                };

                const mouseUpHandler = function() {
                    document.removeEventListener('mousemove', mouseMoveHandler);
                    document.removeEventListener('mouseup', mouseUpHandler);
                    resizer.classList.remove('resizing');
                };

                resizer.addEventListener('mousedown', mouseDownHandler);
            });
        }

        // Init
        renderApproval();
        renderReport();
        renderDetailReport();
        renderRefundReport();
        renderRefundDetailReport();
        initColumnResize();
        
        // Button loading effect
        document.querySelectorAll('.btn-search').forEach(btn => {
            btn.addEventListener('click', function() {
                 const originalHtml = this.innerHTML;
                 this.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Xử lý...';
                 setTimeout(() => {
                     this.innerHTML = originalHtml;
                 }, 800);
            });
        });
    </script>
</body>
</html>
